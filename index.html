<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="LUMOS">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#EBEEED">
    <!-- Open Graph Î©îÌÉÄÌÉúÍ∑∏ -->
    <meta property="og:title" content="LUMOS">
    <meta property="og:description" content="ÏòÅÏóÖ ÌôúÎèôÏùÑ ÎèïÎäî AI Ïï°ÏÖò Í∞ÄÏù¥Îìú">
    <meta property="og:image" content="https://thinkmate.netlify.app/LUMI_front_full.png">
    <meta property="og:url" content="https://thinkmate.netlify.app">
    <meta property="og:type" content="website">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://thinkmate.netlify.app/LUMI_front_full.png">
    <title>LUMOS</title>
    <!-- Pretendard Ìè∞Ìä∏ (Í∞ÄÏû• ÌòÑÎåÄÏ†ÅÏù∏ ÌïúÍ∏Ä Ìè∞Ìä∏) -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        /* --- 1. Î™®Îçò ÎîîÏûêÏù∏ ÏãúÏä§ÌÖú (Design System) --- */
        :root {
            /* Color Palette: Modern Sage */
            --primary: #4A6E5D;        /* Ï∞®Î∂ÑÌïú Îî• Í∑∏Î¶∞ */
            --primary-light: #EBF2EF;  /* ÏïÑÏ£º Ïó∞Ìïú ÎØºÌä∏ Í∑∏Î†àÏù¥ */
            --secondary: #D4A373;      /* Ìè¨Ïù∏Ìä∏: Îî∞ÎúªÌïú ÏÉåÎìú Î≤†Ïù¥ÏßÄ */
            --bg-base: #F5F7F6;        /* Î∞∞Í≤Ω: Ïõú Ïø® Í∑∏Î†àÏù¥ */

            /* Mission Lights Colors */
            --light-off: #E0E0E0;
            --light-on-1: #FFB74D;     /* Ï£ºÌô©Îπõ (ÏÜåÏä§) */
            --light-on-2: #4DB6AC;     /* ÎØºÌä∏Îπõ (ÏßÑÎã®) */
            --light-on-3: #FF8A65;     /* ÏΩîÎûÑÎπõ (ÏûÖÌöå) */

            --surface: #FFFFFF;
            --surface-trans: rgba(255, 255, 255, 0.85);

            --text-title: #2C3531;
            --text-body: #586661;
            --text-caption: #8D9995;

            /* Shadows & Radius */
            --shadow-sm: 0 2px 8px rgba(74, 110, 93, 0.06);
            --shadow-md: 0 12px 24px rgba(74, 110, 93, 0.08), 0 4px 8px rgba(74, 110, 93, 0.04);
            --shadow-float: 0 20px 40px rgba(74, 110, 93, 0.15);

            /* Glow Effects */
            --glow-1: 0 0 15px rgba(255, 183, 77, 0.6);
            --glow-2: 0 0 15px rgba(77, 182, 172, 0.6);
            --glow-3: 0 0 20px rgba(255, 138, 101, 0.8);

            --radius-lg: 28px;
            --radius-md: 20px;
            --radius-sm: 14px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Pretendard', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            height: 100%;
        }

        body {
            background-color: #EEF1F0;
            height: 100%;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            justify-content: center;
            align-items: stretch;
            overflow: hidden;
            color: var(--text-title);
            box-sizing: border-box;
        }

        /* Ïï± Ïª®ÌÖåÏù¥ÎÑà (Ïä§ÎßàÌä∏Ìè∞ ÌôîÎ©¥) */
        .app-container {
            width: 100%;
            height: 100%;
            background: var(--bg-base);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            box-sizing: border-box;
        }

        /* Îç∞Ïä§ÌÅ¨ÌÉëÏóêÏÑúÎßå Ìú¥ÎåÄÌè∞ ÌîÑÎ†àÏûÑ Ìö®Í≥º */
        @media (min-width: 500px) {
            .app-container {
                max-width: 420px;
                max-height: 880px;
                border-radius: 40px;
                border: 12px solid #1a1a1a;
                box-shadow: 0 0 50px rgba(0,0,0,0.1);
            }

            /* ÏÉÅÎã® ÎÖ∏Ïπò Ìö®Í≥º */
            .app-container::before {
                content: '';
                position: absolute;
                top: 0;
                left: 50%;
                transform: translateX(-50%);
                width: 150px;
                height: 25px;
                background: #1a1a1a;
                border-radius: 0 0 20px 20px;
                z-index: 1000;
                pointer-events: none;
            }
        }

        /* --- ÏÉÅÎã® Ìó§Îçî --- */
        .header {
            padding: 24px 24px 10px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: transparent;
            z-index: 10;
        }

        .profile-wrap {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, #769F8B 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            box-shadow: var(--shadow-sm);
        }

        .user-info h1 { font-size: 18px; font-weight: 700; color: var(--text-title); }
        .user-info p { font-size: 13px; color: var(--text-caption); font-weight: 500; }

        .noti-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            position: relative;
        }
        .noti-badge {
            position: absolute;
            top: 10px; right: 10px;
            width: 6px; height: 6px;
            background: #FF5252;
            border-radius: 50%;
        }

        /* --- ÏΩòÌÖêÏ∏† ÏòÅÏó≠ (Ïä§ÌÅ¨Î°§) --- */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 10px 24px 40px 24px;
            scroll-behavior: smooth;
        }

        /* Ïä§ÌÅ¨Î°§Î∞î Ïà®ÍπÄ */
        .content-area::-webkit-scrollbar { display: none; }

        /* ÏÑπÏÖò ÌÉÄÏù¥ÌãÄ */
        .section-title {
            font-size: 19px;
            font-weight: 700;
            margin: 30px 0 16px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .section-title span.more {
            font-size: 13px;
            color: var(--text-caption);
            font-weight: 500;
        }

        /* --- [NEW] Ïò§ÎäòÏùò ÎØ∏ÏÖò ÎåÄÏãúÎ≥¥Îìú --- */
        .mission-dashboard {
            background: var(--surface);
            border-radius: var(--radius-md);
            padding: 16px 20px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .mission-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-title);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .mission-total-pt {
            background: var(--primary-light);
            color: var(--primary);
            font-size: 12px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 12px;
        }

        .mission-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            position: relative;
            z-index: 1;
        }

        .mission-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 4px;
            position: relative;
        }

        /* Î∂àÎπõ (Light) Ïä§ÌÉÄÏùº */
        .light-indicator {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: var(--light-off);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            color: #999;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            border: 3px solid #F5F7F6;
            line-height: 1.2;
        }

        .mission-item.on .light-indicator {
            transform: scale(1.05);
            color: white;
            border-color: white;
        }

        .mission-item.on:nth-child(1) .light-indicator { background: var(--light-on-1); box-shadow: var(--glow-1); }
        .mission-item.on:nth-child(2) .light-indicator { background: var(--light-on-2); box-shadow: var(--glow-2); }
        .mission-item.on:nth-child(3) .light-indicator { background: var(--light-on-3); box-shadow: var(--glow-3); }

        .mission-reward {
            font-size: 10px;
            font-weight: 700;
            color: var(--primary);
            background: rgba(74, 110, 93, 0.1);
            padding: 2px 6px;
            border-radius: 6px;
        }

        .mission-footer {
            margin-top: 12px;
            text-align: center;
            font-size: 11px;
            color: var(--text-caption);
            font-weight: 500;
            background: #FAFAFA;
            padding: 6px;
            border-radius: 8px;
        }

        .bonus-highlight {
            color: var(--secondary);
            font-weight: 700;
        }

        /* --- [NEW] ÎßàÏù¥ÌéòÏù¥ÏßÄ ÏÑ±Í≥º Ïπ¥Îìú --- */
        .performance-card {
            background: var(--surface);
            border-radius: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        .deco-coin {
            position: absolute;
            font-size: 48px;
            opacity: 0.12;
            filter: blur(2px);
            pointer-events: none;
        }
        .deco-coin.top-left { top: -8px; left: -8px; }
        .deco-coin.bottom-right { bottom: -8px; right: -8px; }

        .mypage-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            position: relative;
        }

        .mypage-avatar {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary) 0%, #5A8F7B 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            flex-shrink: 0;
        }

        .mypage-user-info {
            flex: 1;
        }

        .mypage-user-info h1 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-title);
            margin: 0 0 4px 0;
        }

        .mypage-user-info p {
            font-size: 13px;
            color: var(--text-caption);
            margin: 0;
        }

        .perf-refresh-inline {
            width: 36px;
            height: 36px;
            background: var(--bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--text-caption);
            cursor: pointer;
            transition: all 0.2s;
        }
        .perf-refresh-inline:active {
            transform: rotate(180deg);
            background: #E8F5E9;
            color: var(--primary);
        }

        .perf-list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .perf-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #F0F0F0;
            cursor: pointer;
            transition: background 0.2s;
        }
        .perf-item:last-child { border-bottom: none; }
        .perf-item:active { background: #FAFAFA; margin: 0 -24px; padding: 16px 24px; }

        .perf-label {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-title);
        }

        .perf-value-wrap {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .perf-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-body);
        }

        .perf-value.highlight {
            font-size: 20px;
            font-weight: 800;
            color: #FF8F00;
        }

        .perf-arrow {
            font-size: 18px;
            color: #BDBDBD;
            font-weight: 300;
        }

        /* Ìè¨Ïù∏Ìä∏ Ï†ÅÎ¶Ω Í∏∞Ï§Ä ÏòÅÏó≠ */
        .perf-info {
            border-top: 1px dashed #E0E0E0;
            margin-top: 16px;
            padding-top: 16px;
        }

        .perf-info-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-title);
            margin-bottom: 12px;
        }

        .perf-info-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .perf-info-item {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: var(--text-body);
        }

        .perf-info-item.highlight {
            color: var(--primary);
            font-weight: 600;
        }

        /* Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö©Ï≤ò ÏïàÎÇ¥ */
        .perf-usage-msg {
            border-top: 1px dashed #E0E0E0;
            margin-top: 16px;
            padding-top: 16px;
            text-align: center;
            font-size: 13px;
            color: var(--primary);
            font-weight: 500;
        }

        .perf-usage-msg .underline {
            text-decoration: underline;
            font-weight: 600;
        }

        /* --- 1. Bento Grid ÎåÄÏãúÎ≥¥Îìú --- */
        .bento-grid {
            display: grid;
            /* 3Í∞úÏùò Ïª¨ÎüºÏùÑ Ìïú Ï§ÑÎ°ú Î∞∞Ïπò (ÎπÑÏú®Ï°∞Ï†ï: Ï≤´Î≤àÏß∏ Ïπ∏ÏùÑ ÏïΩÍ∞Ñ ÎÑìÍ≤å 1.4 : 1 : 1) */
            grid-template-columns: 1.4fr 1fr 1fr;
            gap: 8px; /* Í∞ÑÍ≤©ÏùÑ 10px -> 8pxÎ°ú Ï¢ÅÌòÄ Í≥µÍ∞Ñ ÌôïÎ≥¥ */
            width: 100%;
        }

        .bento-card {
            background: var(--surface);
            border-radius: var(--radius-md);
            padding: 14px; /* ÎÇ¥Î∂Ä Ïó¨Î∞± ÏµúÏ†ÅÌôî */
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            height: 105px; /* ÎÜíÏù¥ Í≥†Ï†ï */
        }

        .bento-card:active { transform: scale(0.96); }

        .bento-large {
            /* grid-column ÏÜçÏÑ± Ï†úÍ±∞ (Ìïú Ïπ∏Îßå Ï∞®ÏßÄ) */
            background: linear-gradient(120deg, var(--primary) 0%, #355043 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .bento-large::after {
            content: '';
            position: absolute;
            right: -25px; bottom: -25px;
            width: 70px; height: 70px; /* Ïû•Ïãù Ïõê ÌÅ¨Í∏∞ Ï∂ïÏÜå */
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        /* Ï¢ÅÏùÄ Í≥µÍ∞ÑÏùÑ ÏúÑÌïú Ìè∞Ìä∏ Ï°∞Ï†ï */
        .stat-label { font-size: 11px; font-weight: 500; opacity: 0.85; margin-bottom: 2px; white-space: nowrap; }
        .stat-value { font-size: 22px; font-weight: 800; line-height: 1.1; letter-spacing: -0.5px; }
        .stat-sub { font-size: 11px; opacity: 0.8; margin-top: auto; }

        /* --- [NEW] Ïò§ÎäòÏùò ÏùºÏ†ï (Compact & Clean) --- */
        .schedule-block {
            background: var(--surface);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            padding: 0 16px;
            margin-top: 10px;
        }

        .schedule-row {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #F0F0F0;
            min-height: 44px;
        }

        .schedule-row:last-child {
            border-bottom: none;
        }

        .time-badge {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-caption);
            width: 90px;
            flex-shrink: 0;
        }

        .status-divider {
            width: 1px;
            height: 14px;
            background-color: #E0E0E0;
            margin: 0 12px;
        }

        .content-wrap {
            flex: 1;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 6px;
        }

        .task-text {
            font-size: 14px;
            color: var(--text-title);
            font-weight: 500;
            line-height: 1.2;
        }

        .task-sub {
            font-size: 12px;
            color: var(--text-caption);
            margin-top: 0;
        }

        /* Îπà ÏùºÏ†ï Í∞ïÏ°∞ Ïä§ÌÉÄÏùº */
        .task-text-free {
            color: var(--primary);
            font-weight: 800;
            font-size: 14px;
        }

        .task-sub-free {
            color: var(--primary);
            font-weight: 700;
            font-size: 13px;
        }

        /* --- [NEW] 3Í∞ú Î≤ÑÌäº Í∞ÄÎ°ú 1Ìñâ 3Ïó¥ Î©îÎâ¥ --- */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3Ïó¥ Í∞ÄÎ°ú Î∞∞Ïπò */
            gap: 10px;
            margin-top: 16px;
            margin-bottom: 20px;
        }

        .menu-card {
            background: var(--surface);
            border-radius: var(--radius-md);
            padding: 14px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: all 0.2s;
            min-height: 80px;
            text-align: center;
        }

        .menu-card:active { transform: scale(0.96); }

        .menu-icon { font-size: 22px; margin-bottom: 0; }
        .menu-title { font-size: 12px; font-weight: 700; color: var(--text-title); line-height: 1.3; }

        /* Í∞ïÏ°∞ Ïä§ÌÉÄÏùº (AI ÌôúÎèô Ï∂îÏ≤ú) */
        .menu-card.highlight {
            background: var(--primary);
            color: white;
            box-shadow: 0 8px 20px rgba(74, 110, 93, 0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .menu-card.highlight .menu-title { color: white; }

        /* --- 3. Î¶¨Ïä§Ìä∏ Ïä§ÌÉÄÏùº (Ï∂îÏ≤ú Ïû•ÏÜå) --- */
        .place-card {
            background: var(--surface);
            border-radius: var(--radius-md);
            padding: 18px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: var(--shadow-sm);
        }

        .place-img {
            width: 56px; height: 56px;
            border-radius: 16px;
            background-color: #F0F0F0;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px;
        }

        .place-info { flex: 1; }
        .place-name { font-size: 16px; font-weight: 700; color: var(--text-title); margin-bottom: 4px; }
        .place-time { font-size: 13px; color: var(--secondary); font-weight: 600; display: flex; align-items: center; gap: 4px; }

        /* Ïã§ÏãúÍ∞Ñ Î∞òÏßùÏù¥Îäî Ìö®Í≥º */
        .place-time.sparkle {
            background: linear-gradient(90deg, #E65100, #FFD54F, #E65100);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: sparkle 1.5s ease-in-out infinite;
        }
        @keyframes sparkle {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .btn-go {
            width: 40px; height: 40px;
            border-radius: 50%;
            border: 1px solid #eee;
            background: white;
            color: var(--primary);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            font-size: 13px;
        }

        .btn-go:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(74, 110, 93, 0.3);
        }

        .btn-go:active {
            transform: scale(0.95);
        }

        /* --- Ïû•ÏÜå ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ Ïù¥ÎØ∏ÏßÄ ÏòÅÏó≠ (Full-width) --- */
        .place-image-full {
            width: calc(100% + 48px);
            margin-left: -24px;
            margin-right: -24px;
            height: 220px;
            background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
            border-radius: 0;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ÏßÄÎèÑ ÏúÑ ÌïÄ ÎßàÏª§ */
        .map-pin {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -80%);
            font-size: 48px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
            animation: pinBounce 1s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes pinBounce {
            0%, 100% { transform: translate(-50%, -80%); }
            50% { transform: translate(-50%, -90%); }
        }

        /* Í≥µÌÜµ Îí§Î°úÍ∞ÄÍ∏∞ Î≤ÑÌäº */
        .back-btn-common {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            font-weight: 500;
            color: var(--text-title);
            box-shadow: 0 2px 12px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.06);
            transition: all 0.2s ease;
            border: 1px solid rgba(0,0,0,0.04);
            flex-shrink: 0;
        }

        .back-btn-common:active {
            transform: scale(0.92);
            background: linear-gradient(135deg, rgba(240,240,240,0.95) 0%, rgba(235,235,235,0.85) 100%);
        }

        .back-btn-common::before {
            content: '‚Äπ';
            font-size: 26px;
            font-weight: 300;
            line-height: 1;
            margin-top: -2px;
        }

        /* ÏÉÅÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌÖçÏä§Ìä∏ hover Ìö®Í≥º */
        .nav-text-item:hover {
            background: var(--primary-light);
        }

        .nav-text-item.active {
            background: var(--primary-light);
        }

        /* PWA ÏÑ§Ïπò Î≤ÑÌäº */
        .btn-install-pwa {
            display: none;
            font-size: 11px;
            font-weight: 600;
            color: var(--primary);
            background: var(--primary-light);
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .btn-install-pwa:hover {
            background: var(--primary);
            color: white;
        }
        .btn-install-pwa.show {
            display: block;
        }

        /* ÌéòÏù¥ÏßÄ Ï†ÑÌôò Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .page { display: none; animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .page.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ìï´Ïä§Ìåü Ïã§ÏãúÍ∞Ñ Í∞ïÏ°∞ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        @keyframes iconGlow {
            0%, 100% {
                text-shadow: 0 0 10px rgba(255, 152, 0, 0.6),
                             0 0 20px rgba(255, 152, 0, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(255, 152, 0, 0.9),
                             0 0 30px rgba(255, 152, 0, 0.6),
                             0 0 40px rgba(255, 152, 0, 0.3);
            }
        }

        /* Ìï´Ïä§Ìåü Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .hotspot-card {
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 50%, #FFCC80 100%);
            background-size: 200% 200%;
            animation: shimmer 3s ease-in-out infinite;
            border: 2px solid #FF9800;
            box-shadow: 0 8px 24px rgba(255, 152, 0, 0.3),
                        0 0 0 1px rgba(255, 152, 0, 0.1) inset;
            position: relative;
            overflow: hidden;
        }

        .hotspot-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 70%
            );
            animation: shimmer 2s linear infinite;
        }

        .hotspot-icon {
            animation: pulse 2s ease-in-out infinite, iconGlow 2s ease-in-out infinite;
        }

        .hotspot-text {
            animation: blink 1.5s ease-in-out infinite;
            font-weight: 800;
            color: #E65100;
        }

        /* --- LUMI Ï±óÎ¥á Ìó§Îçî --- */
        .lumi-chat-header {
            position: sticky;
            top: -10px;
            margin: -20px -20px 0 0;
            padding: 20px 20px 10px 10px;
            background: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 100;
            min-height: 80px;
        }

        .lumi-back-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 18px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .lumi-back-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .lumi-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-image: url('LUMI_front.png');
            background-size: cover;
            background-position: center;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(255, 183, 77, 0.4);
        }

        .lumi-info {
            flex: 1;
        }

        .lumi-name {
            font-size: 17px;
            font-weight: 700;
            color: white;
        }

        .lumi-status {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 2px;
        }

        /* Ï±óÎ¥á ÌéòÏù¥ÏßÄ Î†àÏù¥ÏïÑÏõÉ (Î©îÏã†Ï†Ä Ïä§ÌÉÄÏùº) */
        #page-chat {
            display: none;
            flex-direction: column;
            padding: 0 !important;
            overflow: hidden;
            height: 100%;
        }
        #page-chat.active {
            display: flex;
        }

        #page-chat .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 16px 20px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .chat-bubble {
            max-width: 80%;
            padding: 14px 18px;
            font-size: 15px;
            line-height: 1.5;
            position: relative;
        }
        .bot {
            background: white;
            border-radius: 20px 20px 20px 4px;
            box-shadow: var(--shadow-sm);
            align-self: flex-start;
            color: var(--text-body);
        }
        .user {
            background: var(--primary);
            color: white;
            border-radius: 20px 20px 4px 20px;
            align-self: flex-end;
            box-shadow: 0 4px 12px rgba(74, 110, 93, 0.2);
        }

        /* ÏÑ†ÌÉùÏßÄ Ïπ© ÏòÅÏó≠ (chat-box ÏïàÏóêÏÑú) */
        #chat-box .quick-chips {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            padding: 0;
            margin-top: 4px;
            background: transparent;
        }
        #chat-box .quick-chips:empty {
            display: none;
        }
        .chip {
            background: white;
            border: 1px solid rgba(74, 110, 93, 0.2);
            color: var(--primary);
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .chip:hover { background: var(--primary); color: white; border-color: transparent; }

        /* ÌïòÎã® Í≥†Ï†ï ÏûÖÎ†• Î∞î */
        .chat-input-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background: white;
            border-top: 1px solid #E8E8E8;
            flex-shrink: 0;
        }
        .chat-input-bar input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #E0E0E0;
            border-radius: 24px;
            font-size: 15px;
            font-family: inherit;
            outline: none;
            transition: border-color 0.2s;
        }
        .chat-input-bar input:focus {
            border-color: var(--primary);
        }
        .chat-input-bar .send-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .chat-input-bar .send-btn:hover {
            background: #3D5C4D;
        }
        .chat-input-bar .send-btn:active {
            transform: scale(0.95);
        }
        .chat-input-bar .send-btn::before {
            content: '‚û§';
            color: white;
            font-size: 18px;
        }

        /* ÌôúÎèô GO! Î≤ÑÌäº hover Ìö®Í≥º */
        .btn-sales-start:hover {
            background: var(--primary) !important;
            color: white !important;
        }

        /* --- Î∞©Î¨∏ Í≤∞Í≥º ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ Ïä§ÌÉÄÏùº --- */
        .visit-result-header {
            background: linear-gradient(135deg, var(--primary) 0%, #5D8A72 100%);
            margin: -10px -24px 20px -24px;
            padding: 24px;
            border-radius: 0 0 28px 28px;
            color: white;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .visit-result-header .place-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .visit-result-header .place-title {
            flex: 1;
            font-size: 18px;
            font-weight: 700;
        }

        .result-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 12px;
            box-shadow: var(--shadow-sm);
        }

        .result-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .result-card-label {
            font-size: 13px;
            color: var(--text-caption);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .result-card-edit {
            font-size: 13px;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .result-card-edit:hover {
            background: var(--primary-light);
        }

        .result-card-value {
            font-size: 16px;
            color: var(--text-title);
            font-weight: 600;
            line-height: 1.5;
        }

        .result-card-value.sub {
            font-size: 14px;
            color: var(--text-body);
            font-weight: 500;
        }

        /* Í≤∞Í≥º ÏÉÅÌÉú Î∞∞ÏßÄ */
        .result-status {
            display: inline-flex;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .result-status.none {
            background: #F5F5F5;
            color: #9E9E9E;
        }

        .result-status.source {
            background: #E3F2FD;
            color: #1976D2;
        }

        .result-status.success {
            background: #E8F5E9;
            color: #2E7D32;
        }

        /* Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            width: 100%;
            max-width: 360px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease-out;
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* --- [Îû≠ÌÇπ] ÌéòÏù¥ÏßÄ Ïä§ÌÉÄÏùº --- */
        /* Top 3 Ìè¨ÎîîÏõÄ */
        .ranking-podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 260px;
            margin-bottom: 0;
            gap: 12px;
        }

        .podium-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* ÏàúÏúÑÎ≥Ñ ÎÜíÏù¥ Î∞è Ïä§ÌÉÄÏùº */
        .podium-1 { order: 2; z-index: 2; margin-bottom: 10px; }
        .podium-2 { order: 1; }
        .podium-3 { order: 3; }

        .rank-avatar {
            width: 50px; height: 50px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: var(--shadow-sm);
            margin-bottom: -15px;
            z-index: 2;
            background-color: #ddd;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px;
        }

        .podium-1 .rank-avatar { width: 64px; height: 64px; border-color: #FFD700; font-size: 30px; }

        .rank-box {
            width: 100px;
            border-radius: 12px 12px 0 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            color: white;
            box-shadow: var(--shadow-md);
            position: relative;
        }

        .rank-box::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 20px;
            background: inherit;
            z-index: -1;
        }

        /* 1Îì± (Í≥®Îìú) */
        .podium-1 .rank-box {
            height: 185px;
            background: linear-gradient(135deg, #FFD700 0%, #FDB931 100%);
        }
        /* 2Îì± (Ïã§Î≤Ñ) */
        .podium-2 .rank-box {
            height: 155px;
            background: linear-gradient(135deg, #E0E0E0 0%, #BDBDBD 100%);
        }
        /* 3Îì± (Î∏åÎ°†Ï¶à) */
        .podium-3 .rank-box {
            height: 130px;
            background: linear-gradient(135deg, #CD7F32 0%, #A05A2C 100%);
        }

        .rank-num { font-size: 24px; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 4px; }
        .rank-name { font-size: 13px; font-weight: 700; margin-bottom: 2px; }
        .rank-group { font-size: 11px; opacity: 0.9; margin-bottom: 4px; text-align: center; }
        .rank-score { font-size: 16px; font-weight: 800; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }

        .rank-crown { position: absolute; top: -30px; font-size: 32px; animation: crownFloat 2s infinite ease-in-out; }

        @keyframes crownFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* 4~10ÏúÑ Î¶¨Ïä§Ìä∏ */
        .ranking-list {
            background: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            padding: 10px 20px;
            position: relative;
            z-index: 10;
            margin-top: -10px;
        }

        .rank-row {
            display: flex;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .rank-row:last-child { border-bottom: none; }

        .r-rank { font-size: 16px; font-weight: 700; color: var(--text-caption); width: 30px; text-align: center; }
        .r-info { flex: 1; margin-left: 12px; display: flex; align-items: center; gap: 6px; }
        .r-name { font-size: 15px; font-weight: 600; color: var(--text-title); }

        .r-group {
            font-size: 12px;
            color: var(--text-caption);
            margin-top: 0;
            padding-left: 6px;
            border-left: 1px solid #ddd;
            line-height: 1;
        }

        .r-score { font-size: 15px; font-weight: 700; color: var(--primary); }

        /* --- ÌîåÎ°úÌåÖ Ï±óÎ¥á Î≤ÑÌäº (LUMI) --- */
        .floating-chat-btn {
            position: absolute;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-image: url('LUMI_front.png');
            background-size: cover;
            background-position: center;
            background-color: var(--primary);
            border: 3px solid white;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25), 0 2px 8px rgba(74, 110, 93, 0.3);
            cursor: pointer;
            z-index: 100;
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .floating-chat-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3), 0 4px 12px rgba(74, 110, 93, 0.4);
        }

        .floating-chat-btn:active {
            transform: scale(0.95);
        }

        /* ÏïåÎ¶º Î±ÉÏßÄ (Îπ®Í∞Ñ Ï†ê) */
        .floating-chat-btn::after {
            content: '';
            position: absolute;
            top: 2px;
            right: 2px;
            width: 14px;
            height: 14px;
            background: #FF5252;
            border-radius: 50%;
            border: 2px solid white;
            animation: badgePulse 2s ease-in-out infinite;
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(50px);
            }
            50% {
                opacity: 1;
                transform: scale(1.1) translateY(-10px);
            }
            70% {
                transform: scale(0.95) translateY(5px);
            }
            100% {
                transform: scale(1) translateY(0);
            }
        }

        @keyframes badgePulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        /* --- [NEW] Ïò§Îäò ÌôúÎèô ÏôÑÎ£å Î¶¨Ìè¨Ìä∏ Ïï†ÎãàÎ©îÏù¥ÏÖò --- */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        /* Ïò§Îäò ÌôúÎèô ÏôÑÎ£å Î≤ÑÌäº */
        .btn-finish-daily {
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, #2C3E50 0%, #4A6E5D 100%);
            color: white;
            font-size: 16px;
            font-weight: 700;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            margin-top: 16px;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-finish-daily:active {
            transform: scale(0.98);
            box-shadow: 0 2px 8px rgba(44, 62, 80, 0.3);
        }

        /* Î¶¨Ìè¨Ìä∏ ÌéòÏù¥ÏßÄ Ïä§ÌÉÄÏùº */
        #page-finish {
            background: white;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 60px 20px 40px 20px;
            min-height: 100%;
            height: 100%;
            z-index: 300;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            box-sizing: border-box;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-title);
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-input-group {
            margin-bottom: 16px;
        }

        .modal-input-label {
            font-size: 13px;
            color: var(--text-caption);
            margin-bottom: 8px;
            display: block;
        }

        .modal-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #E0E0E0;
            border-radius: 14px;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .modal-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #E0E0E0;
            border-radius: 14px;
            font-size: 15px;
            font-family: inherit;
            min-height: 100px;
            resize: none;
            transition: border-color 0.2s;
        }

        .modal-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 24px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px;
            border-radius: 14px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .modal-btn.cancel {
            background: #F5F5F5;
            color: var(--text-body);
        }

        .modal-btn.cancel:hover {
            background: #E0E0E0;
        }

        .modal-btn.save {
            background: var(--primary);
            color: white;
        }

        .modal-btn.save:hover {
            background: #3D5C4D;
        }

        /* Í≤∞Í≥º ÏÑ†ÌÉù ÏòµÏÖò */
        .result-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .result-option {
            padding: 16px;
            border: 2px solid #E0E0E0;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .result-option:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .result-option.selected {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .result-option-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .result-option-text {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-title);
        }

        /* ÎßàÏù¥ÌéòÏù¥ÏßÄ Ïù¥Î†• Ïπ¥Îìú ÌÅ¥Î¶≠ Í∞ÄÎä• ÌëúÏãú */
        .history-card {
            cursor: pointer;
            transition: all 0.2s;
        }

        .history-card:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-md);
        }

        .history-card .arrow-icon {
            color: var(--text-caption);
            font-size: 16px;
            font-weight: 600;
        }

    </style>
</head>
<body>

<div class="app-container">

    <!-- Í≥µÌÜµ Ìó§Îçî -->
    <header class="header" style="justify-content:space-between; padding:24px 20px 10px 20px;">
        <!-- Îí§Î°úÍ∞ÄÍ∏∞ Î≤ÑÌäº (ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄÏóêÏÑúÎßå ÌëúÏãú) -->
        <div id="header-back-btn" class="back-btn-common" style="visibility:hidden;" onclick="goBack()"></div>
        <!-- ÏÉÅÎã® ÌÖçÏä§Ìä∏ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <div style="display:flex; gap:8px; align-items:center;">
            <div class="nav-text-item active" onclick="goToPage('home')" style="font-size:14px; font-weight:600; color:var(--primary); cursor:pointer; padding:8px 12px; border-radius:8px; transition:all 0.2s;">Ìôà</div>
            <span style="color:#E0E0E0;">|</span>
            <div class="nav-text-item" onclick="goToPage('mypage')" style="font-size:14px; font-weight:600; color:var(--text-caption); cursor:pointer; padding:8px 12px; border-radius:8px; transition:all 0.2s;">ÎßàÏù¥</div>
            <span style="color:#E0E0E0;">|</span>
            <div class="nav-text-item" onclick="goToPage('ranking')" style="font-size:14px; font-weight:600; color:var(--text-caption); cursor:pointer; padding:8px 12px; border-radius:8px; transition:all 0.2s;">Îû≠ÌÇπ</div>
        </div>
        <!-- PWA ÏÑ§Ïπò Î≤ÑÌäº -->
        <button id="btn-install-pwa" class="btn-install-pwa" onclick="installPWA()">+ Ïï±ÏÑ§Ïπò</button>
    </header>

    <!-- 1. Î©îÏù∏ Ìôà (ÎåÄÏãúÎ≥¥Îìú) -->
    <div id="page-home" class="content-area page active">

        <!-- [NEW] Ïò§ÎäòÏùò ÎØ∏ÏÖò ÎåÄÏãúÎ≥¥Îìú -->
        <div class="mission-dashboard" onclick="goToPage('mypage')" style="cursor:pointer;">
            <div class="mission-header">
                <div class="mission-title">
                    <span>üî• Ïò§ÎäòÏùò ÎØ∏ÏÖò</span>
                </div>
                <div class="mission-total-pt">+ 40P</div>
            </div>

            <div class="mission-grid">
                <!-- ÎØ∏ÏÖò 1: Ïã†Í∑ú ÏÜåÏä§ (Îã¨ÏÑ± ÏÉÅÌÉú) -->
                <div class="mission-item on">
                    <div class="light-indicator">
                        <span>Ïã†Í∑ú</span>
                        <span>ÏÜåÏä§</span>
                    </div>
                    <div class="mission-reward">+20P</div>
                </div>

                <!-- ÎØ∏ÏÖò 2: Ïã†Í∑ú ÏßÑÎã® (Îã¨ÏÑ± ÏÉÅÌÉú) -->
                <div class="mission-item on">
                    <div class="light-indicator">
                        <span>Ïã†Í∑ú</span>
                        <span>ÏßÑÎã®</span>
                    </div>
                    <div class="mission-reward">+20P</div>
                </div>

                <!-- ÎØ∏ÏÖò 3: ÏûÖÌöå (ÎØ∏Îã¨ÏÑ± ÏÉÅÌÉú) -->
                <div class="mission-item">
                    <div class="light-indicator">
                        <span>ÏûÖÌöå</span>
                    </div>
                    <div class="mission-reward">+50P</div>
                </div>
            </div>

            <div class="mission-footer">
                ‚ú® 3Í∞ú Î™®Îëê Îã¨ÏÑ± Ïãú <span class="bonus-highlight">100pt</span> Ï∂îÍ∞Ä ÏßÄÍ∏â
            </div>
        </div>

        <!-- ÏßÄÍ∏à Í∞ÄÏïº Ìï† Ìï´Ïä§Ìåü -->
        <div class="section-title">
            ÏßÄÍ∏à Í∞ÄÏïº Ìï† Ìï´Ïä§Ìåü
            <span class="more" onclick="goToPage('recommend')">ÎçîÎ≥¥Í∏∞</span>
        </div>

        <div id="hotspot-card" class="place-card hotspot-card" onclick="goToPage('recommend')">
            <div id="hotspot-icon" class="place-img hotspot-icon" style="background:linear-gradient(135deg, #FFE0B2, #FF9800); color:#E65100;">üå≤</div>
            <div class="place-info">
                <div id="hotspot-name" class="place-name" style="color:#E65100; font-weight:800;">Ìö®ÏõêÍ≥µÏõê</div>
                <div class="place-time hotspot-text">‚ö° ÏßÄÍ∏à Ïú†ÎèôÏù∏Íµ¨ Í∏âÏ¶ù Ï§ë</div>
            </div>
            <div class="btn-go" style="background:#FF9800; color:white; border-color:#FF9800;">‚ûî</div>
        </div>

        <!-- 3Í∞ú Ï£ºÏöî Í∏∞Îä• Î≤ÑÌäº (Í∞ÄÎ°ú 1Ìñâ 3Ïó¥) -->
        <div class="menu-grid">
            <!-- 1. AI ÌôúÎèô Ï∂îÏ≤ú (Í∞ïÏ°∞) -->
            <div class="menu-card highlight" onclick="goToPage('recommend')">
                <div class="menu-icon">üöÄ</div>
                <div class="menu-title">AI ÌôúÎèô Ï∂îÏ≤ú</div>
            </div>

            <!-- 2. ÏÑ±Í≥º Îì±Î°ù -->
            <div class="menu-card" onclick="goToPage('chat')">
                <div class="menu-icon">üìù</div>
                <div class="menu-title">ÏÑ±Í≥º Îì±Î°ù</div>
            </div>

            <!-- 3. Ïò§Îäò ÌôúÎèô ÏôÑÎ£å -->
            <div class="menu-card" onclick="showDailyReport()">
                <div class="menu-icon">‚úÖ</div>
                <div class="menu-title">Ïò§Îäò ÌôúÎèô ÏôÑÎ£å</div>
            </div>
        </div>

        <!-- Ïò§ÎäòÏùò ÏùºÏ†ï -->
        <div class="section-title">
            Ïò§ÎäòÏùò ÏùºÏ†ï
        </div>

        <div class="schedule-block" id="schedule-list">
            <!-- 09:00 - 10:00 -->
            <div class="schedule-row" onclick="openScheduleModal(0)" style="cursor:pointer;">
                <span class="time-badge">09:00 - 10:00</span>
                <div class="status-divider"></div>
                <div class="task-info">
                    <span class="task-text">ÏóÖÎ¨¥ ÌôïÏù∏ Î∞è Í∏∞Ï°¥ Í≥†Í∞ù Í¥ÄÎ¶¨</span>
                    <span class="task-sub"></span>
                </div>
            </div>
            <!-- 10:00 - 11:00 -->
            <div class="schedule-row" onclick="openScheduleModal(1)" style="cursor:pointer;">
                <span class="time-badge">10:00 - 11:00</span>
                <div class="status-divider"></div>
                <div class="task-info">
                    <span class="task-text">ÎØ∏ÌåÖ Î∞è ÍµêÏú°</span>
                    <span class="task-sub"></span>
                </div>
            </div>
            <!-- 11:00 - 12:00 (ÏòÅÏóÖ Í∞ÄÎä•) -->
            <div class="schedule-row free" onclick="goToPage('recommend')" style="cursor:pointer;">
                <span class="time-badge">11:00 - 12:00</span>
                <div class="status-divider"></div>
                <div class="task-info">
                    <span class="task-text task-text-free">ÏùºÏ†ïÏóÜÏùå</span>
                    <span class="task-sub task-sub-free">‚ö°ÏòÅÏóÖÍ∞ÄÎä•</span>
                </div>
            </div>
            <!-- 12:00 - 13:00 -->
            <div class="schedule-row" onclick="openScheduleModal(3)" style="cursor:pointer;">
                <span class="time-badge">12:00 - 13:00</span>
                <div class="status-divider"></div>
                <div class="task-info">
                    <span class="task-text">Ï†êÏã¨ ÏãúÍ∞Ñ</span>
                    <span class="task-sub"></span>
                </div>
            </div>
            <!-- 13:00 - 14:00 -->
            <div class="schedule-row" onclick="openScheduleModal(4)" style="cursor:pointer;">
                <span class="time-badge">13:00 - 14:00</span>
                <div class="status-divider"></div>
                <div class="task-info">
                    <span class="task-text">ÎÇòÏõÖÏßÑ Í≥†Í∞ù ÏÉÅÎã¥</span>
                    <span class="task-sub">üìç ÏÇºÏÑ±1Ï∞®</span>
                </div>
            </div>
            <!-- 14:00 - 15:00 (ÏòÅÏóÖ Í∞ÄÎä•) -->
            <div class="schedule-row free" onclick="goToPage('recommend')" style="cursor:pointer;">
                <span class="time-badge">14:00 - 15:00</span>
                <div class="status-divider"></div>
                <div class="task-info">
                    <span class="task-text task-text-free">ÏùºÏ†ïÏóÜÏùå</span>
                    <span class="task-sub task-sub-free">‚ö°ÏòÅÏóÖÍ∞ÄÎä•</span>
                </div>
            </div>
            <!-- 15:00 - 17:00 -->
            <div class="schedule-row" onclick="openScheduleModal(6)" style="cursor:pointer;">
                <span class="time-badge">15:00 - 17:00</span>
                <div class="status-divider"></div>
                <div class="task-info">
                    <span class="task-text">ÌåêÏ¥â ÌôúÎèô</span>
                    <span class="task-sub">üìç ÍøàÎÇòÎ¨¥ Ïñ¥Î¶∞Ïù¥Ïßë</span>
                </div>
            </div>
            <!-- 17:00 - 18:00 -->
            <div class="schedule-row" onclick="openScheduleModal(7)" style="cursor:pointer;">
                <span class="time-badge">17:00 - 18:00</span>
                <div class="status-divider"></div>
                <div class="task-info">
                    <span class="task-text">ÏóÖÎ¨¥ ÎßàÎ¨¥Î¶¨</span>
                    <span class="task-sub"></span>
                </div>
            </div>
        </div>

    </div>

    <!-- 2. AI Ï∂îÏ≤ú ÌéòÏù¥ÏßÄ -->
    <div id="page-recommend" class="content-area page">
        <!-- ÌòÑÏû¨ ÏúÑÏπò Ïπ¥Îìú -->
        <div style="width:100%; background:white; border-radius:24px; margin-bottom:20px; position:relative; overflow:hidden; box-shadow:var(--shadow-sm);">
            <!-- ÏßÄÎèÑ Ïù¥ÎØ∏ÏßÄ -->
            <div style="width:100%; height:150px; position:relative;">
                <img src="ÏàòÏõêÏÇ¨ÏóÖÍµ≠_map.jpg" alt="ÌòÑÏû¨ ÏúÑÏπò ÏßÄÎèÑ" style="width:100%; height:100%; object-fit:cover;">
                <div class="map-pin" style="font-size:36px;">üìç</div>
            </div>
            <!-- ÏúÑÏπò Ï†ïÎ≥¥ -->
            <div style="padding:16px;">
                <div style="display:flex; align-items:center; gap:12px; margin-bottom:10px;">
                    <div style="flex:1;">
                        <div style="font-size:11px; color:var(--primary); font-weight:600; margin-bottom:3px;">ÌòÑÏû¨ ÏúÑÏπò</div>
                        <div style="font-size:16px; font-weight:800; color:var(--text-title);">ÏàòÏõêÏÇ¨ÏóÖÍµ≠</div>
                    </div>
                    <div style="background:var(--primary); color:white; padding:6px 12px; border-radius:12px; font-size:11px; font-weight:700;">
                        Ï∂úÎ∞úÏßÄ
                    </div>
                </div>
                <div style="background:var(--bg-base); padding:10px 14px; border-radius:14px; font-size:12px; color:var(--text-body); line-height:1.4;">
                    üìå Í≤ΩÍ∏∞ ÏàòÏõêÏãú ÏòÅÌÜµÍµ¨ Ìö®ÏõêÎ°ú 400 (Îß§ÌÉÑÎèô) ÌÉëÌîÑÎùºÏûê 601Ìò∏
                </div>
            </div>
        </div>

        <!-- Ï£ºÎ≥Ä Ï∂îÏ≤ú Ïû•ÏÜå ÌÉÄÏù¥ÌãÄ -->
        <div class="section-title" style="margin-top:0;">üìç Ï£ºÎ≥Ä Ï∂îÏ≤ú Ïû•ÏÜå</div>
        <div style="font-size:12px; color:var(--text-caption); margin-bottom:16px; margin-top:-10px; font-weight:500;">
            ÎèÑÎ≥¥ Í±∞Î¶¨, Ïù∏Ïõê Ïàò Í∏∞Î∞ò Ï∂îÏ≤ú Ïû•ÏÜå
        </div>

        <!-- ÎûúÎç§ ÏàúÏÑúÎ°ú Î†åÎçîÎßÅÎêòÎäî Ïû•ÏÜå Ïπ¥Îìú -->
        <div id="recommend-places-list"></div>
    </div>

    <!-- 2-1. Ïû•ÏÜå ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ (Ìë∏Î•∏ÏÜî Í≥µÏõê) -->
    <div id="page-place-detail" class="content-area page">
        <!-- Ïû•ÏÜå Ïù¥Î¶Ñ -->
        <h2 id="place-detail-title" style="font-size:18px; font-weight:700; color:var(--text-title); margin-bottom:12px;">Ìö®ÏõêÍ≥µÏõê</h2>
        <!-- ÏßÄÎèÑ ÏòÅÏó≠ (Ïû•ÏÜå Ïù¥ÎØ∏ÏßÄ - Full-width) -->
        <div id="place-image-container" class="place-image-full">
            <!-- Í≥µÎûÄ ÌîåÎ†àÏù¥Ïä§ÌôÄÎçî -->
            <div style="text-align:center;">
                <div style="font-size:48px; margin-bottom:8px; opacity:0.4;">üìç</div>
                <div style="font-size:14px; color:var(--text-caption); opacity:0.6;">Ïû•ÏÜå Ïù¥ÎØ∏ÏßÄ ÏòÅÏó≠</div>
            </div>
        </div>

        <!-- Í±∞Î¶¨/ÏãúÍ∞Ñ Ï†ïÎ≥¥ Ïπ¥Îìú -->
        <div class="place-info-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:24px;">
            <div style="background:white; border-radius:20px; padding:16px; box-shadow:var(--shadow-sm);">
                <div style="font-size:11px; color:var(--text-caption); margin-bottom:4px;">ÎèÑÎ≥¥ Í±∞Î¶¨</div>
                <div style="font-size:18px; color:var(--primary); font-weight:700;">ÏïΩ 350m</div>
            </div>
            <div style="background:white; border-radius:20px; padding:16px; box-shadow:var(--shadow-sm);">
                <div style="font-size:11px; color:var(--text-caption); margin-bottom:4px;">ÏÜåÏöî ÏãúÍ∞Ñ</div>
                <div style="font-size:18px; color:var(--primary); font-weight:700;">ÏïΩ 5Î∂Ñ</div>
            </div>
        </div>

        <!-- AI Í∞ÄÏù¥Îìú -->
        <div style="display:flex; align-items:center; gap:8px; margin-bottom:12px;">
            <div style="width:32px; height:32px; border-radius:50%; background-image:url('LUMI_front.png'); background-size:cover; background-position:center;"></div>
            <span style="font-size:16px; color:var(--text-title); font-weight:600;">LUMIÏùò Ïï°ÏÖò Í∞ÄÏù¥Îìú</span>
        </div>

        <!-- Ï≤´ Î≤àÏß∏ Î©îÏãúÏßÄ -->
        <div class="ai-message" style="background:white; border-radius:20px 20px 20px 4px; padding:18px; margin-bottom:12px; box-shadow:var(--shadow-sm);">
            <p style="font-size:15px; color:var(--text-body); line-height:1.6;">
                Ïûê, Ïñ¥Ï†ú AÎã®ÏßÄÎäî Í∞îÏóàÏ£†?<br />
                Ïò§ÎäòÏùÄ <strong style="color:var(--primary);">Ìë∏Î•∏ÏÜî Í≥µÏõê ÎÜÄÏù¥ÌÑ∞</strong>ÏûÖÎãàÎã§. Ïó¨Í∏¥ ÏßÄÍ∏à <strong style="color:#FF9800;">Ï¥àÎì±ÏÉù ÌïòÍµê ÏãúÍ∞Ñ</strong>Ïù¥Îùº ÏóÑÎßàÎì§Ïù¥ Ï†úÏùº ÎßéÏù¥ Î™®Ïó¨ ÏûàÏñ¥Ïöî!
            </p>
        </div>

        <!-- ÏïåÎú∞Ïû•ÌÑ∞ ÌäπÎ≥Ñ ÏïåÎ¶º -->
        <div class="event-section" style="background:linear-gradient(135deg, #FFF8E1, #FFE082); border-radius:20px 20px 20px 4px; padding:20px; margin-bottom:16px; border:2px solid #FFC107; box-shadow:var(--shadow-md);">
            <p style="font-size:15px; color:#F57F17; line-height:1.6; margin-bottom:16px;">
                Í≤åÎã§Í∞Ä Ïò§Îäò Í±∞Í∏¥ <strong>ÏïåÎú∞Ïû•ÌÑ∞ ÎÇ†</strong>Ïù¥ÏóêÏöî!<br />
                Ïû•ÌÑ∞ ÌåÄÏû•Îãò Î≤àÌò∏ ÎùÑÏõåÎìúÎ¶¥ ÌÖåÎãà ÏûêÎ¶¨Î∂ÄÌÑ∞ Ïû°ÏúºÏÑ∏Ïöî. ÌåêÏ¥âÎ¨º Ï±ôÍ∏∞ÏÖ®Ï£†?
            </p>

            <!-- Ï†ïÎ≥¥ Ïπ¥Îìú -->
            <div style="background:rgba(255,255,255,0.9); border-radius:16px; padding:16px;">
                <!-- Ïù¥Î≤§Ìä∏ Ï†ïÎ≥¥ -->
                <div style="display:flex; align-items:start; gap:12px; padding-bottom:12px; border-bottom:1px solid #F0F0F0;">
                    <div style="font-size:20px;">üö©</div>
                    <div style="flex:1;">
                        <div style="font-size:13px; color:var(--text-caption); margin-bottom:4px;">Ïò§ÎäòÏùò Ïù¥Î≤§Ìä∏</div>
                        <div style="font-size:15px; color:var(--text-title);">C ÏïÑÌååÌä∏ ÏïåÎú∞Ïû•ÌÑ∞ Ïó¥Î¶º</div>
                    </div>
                </div>

                <!-- ÌåÄÏû•Îãò Ïó∞ÎùΩÏ≤ò -->
                <div style="display:flex; align-items:start; gap:12px; padding:12px 0; border-bottom:1px solid #F0F0F0;">
                    <div style="font-size:20px;">üìû</div>
                    <div style="flex:1;">
                        <div style="font-size:13px; color:var(--text-caption); margin-bottom:4px;">Ïû•ÌÑ∞ ÌåÄÏû•Îãò</div>
                        <div style="font-size:15px; color:var(--primary); display:flex; align-items:center; gap:8px;">
                            010-3456-7890
                            <a href="tel:010-3456-7890" style="font-size:12px; background:var(--primary); color:white; padding:4px 12px; border-radius:20px; text-decoration:none;">Ï†ÑÌôî</a>
                        </div>
                    </div>
                </div>

                <!-- Ï§ÄÎπÑÎ¨º Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ -->
                <div style="display:flex; align-items:start; gap:12px; padding-top:12px;">
                    <div style="font-size:20px;">üéí</div>
                    <div style="flex:1;">
                        <div style="font-size:13px; color:var(--text-caption); margin-bottom:8px;">Ï§ÄÎπÑÎ¨º Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</div>
                        <div style="display:flex; flex-direction:column; gap:6px;">
                            <label style="display:flex; align-items:center; gap:8px; font-size:14px; color:var(--text-body); cursor:pointer;">
                                <input type="checkbox" style="width:16px; height:16px; accent-color:var(--primary); border-radius:4px;">
                                <span>ÌÖåÏù¥Î∏î 1Í∞ú</span>
                            </label>
                            <label style="display:flex; align-items:center; gap:8px; font-size:14px; color:var(--text-body); cursor:pointer;">
                                <input type="checkbox" style="width:16px; height:16px; accent-color:var(--primary); border-radius:4px;">
                                <span>ÌåêÏ¥âÎ¨º 50Í∞ú</span>
                            </label>
                            <label style="display:flex; align-items:center; gap:8px; font-size:14px; color:var(--text-body); cursor:pointer;">
                                <input type="checkbox" style="width:16px; height:16px; accent-color:var(--primary); border-radius:4px;">
                                <span>Î™ÖÌï® & Î¶¨ÌîåÎ†õ</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ï∂îÏ≤ú ÌôúÎèô ÏãúÍ∞Ñ -->
        <div class="tips-section" style="background:var(--primary-light); border-radius:16px; padding:16px; margin-bottom:24px;">
            <div style="display:flex; align-items:start; gap:12px;">
                <div style="font-size:20px;">üí°</div>
                <div style="flex:1;">
                    <div style="font-size:13px; color:var(--primary); margin-bottom:8px; font-weight:600;">Ï∂îÏ≤ú ÌôúÎèô ÏãúÍ∞Ñ</div>
                    <div style="font-size:14px; color:var(--text-body); line-height:1.6;">
                        ‚Ä¢ Ïò§ÌõÑ 2Ïãú~4Ïãú: ÌïòÍµê ÏãúÍ∞Ñ ÏßëÏ§ë Í≥µÎûµ<br />
                        ‚Ä¢ Ïò§ÌõÑ 4Ïãú~6Ïãú: ÏïåÎú∞Ïû•ÌÑ∞ Î∞©Î¨∏Í∞ù ÎåÄÏÉÅ
                    </div>
                </div>
            </div>
        </div>

        <!-- ÌïòÎã® Ïï°ÏÖò Î≤ÑÌäº -->
        <div style="display:flex; flex-direction:column; gap:10px; margin-top:24px; padding-bottom:20px;">
            <!-- Ïπ¥Ïπ¥Ïò§ÎÇ¥ÎπÑ Î≤ÑÌäº -->
            <button id="btn-navi" onclick="goToNaviPage()" style="width:100%; height:56px; background:linear-gradient(135deg, var(--primary), #5D8A72); color:white; border:none; border-radius:16px; font-size:16px; font-weight:700; cursor:pointer; box-shadow:0 8px 20px rgba(74, 110, 93, 0.3); display:flex; align-items:center; justify-content:center; gap:8px; transition:all 0.2s;">
                <span>üöÄ</span>
                <span>Ïπ¥Ïπ¥Ïò§ÎÇ¥ÎπÑÎ°ú Ï∂úÎ∞úÌïòÍ∏∞</span>
            </button>
            <!-- ÌôúÎèô GO! Î≤ÑÌäº -->
            <button class="btn-sales-start" onclick="startSalesActivity()" style="width:100%; height:56px; background:white; border:2px solid var(--primary); color:var(--primary); border-radius:16px; font-size:16px; font-weight:700; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px; transition:all 0.2s;">
                <span>üíº</span>
                <span>ÌôúÎèô GO!</span>
            </button>
        </div>
    </div>

    <!-- 3. ÏÑ±Í≥º ÏûÖÎ†• Ï±óÎ¥á ÌéòÏù¥ÏßÄ -->
    <div id="page-chat" class="page">
        <!-- LUMI Ìó§Îçî -->
        <div class="lumi-chat-header">
            <div class="lumi-avatar"></div>
            <div class="lumi-info">
                <div class="lumi-name">LUMI</div>
                <div class="lumi-status" id="chat-place-name">AI Ïï°ÏÖò Í∞ÄÏù¥Îìú</div>
            </div>
        </div>

        <!-- Ï±ÑÌåÖ Î©îÏãúÏßÄ ÏòÅÏó≠ -->
        <div class="chat-container" id="chat-box">
            <!-- ÎèôÏ†Å Î©îÏãúÏßÄ Ï∂îÍ∞ÄÎê® -->
        </div>

        <!-- ÌïòÎã® Í≥†Ï†ï ÏûÖÎ†• Î∞î -->
        <div class="chat-input-bar">
            <input type="text" id="chat-input" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." />
            <button class="send-btn" id="chat-send-btn"></button>
        </div>
    </div>

    <!-- 4. ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌôîÎ©¥ (Ïï± Ïª®ÌÖåÏù¥ÎÑà ÎÇ¥ Ï†ÑÏ≤¥ ÌôîÎ©¥) -->
    <div id="page-navi" class="page" style="position:absolute; top:0; left:0; right:0; bottom:0; background:#000; z-index:100; padding:0;">
        <!-- ÎÑ§ÎπÑ Ïù¥ÎØ∏ÏßÄ Ïï± Ïª®ÌÖåÏù¥ÎÑà ÎÇ¥ Ï†ÑÏ≤¥ -->
        <div style="width:100%; height:100%; position:relative; overflow:hidden;">
            <!-- Ïã§Ï†ú ÎÑ§ÎπÑ Ïù¥ÎØ∏ÏßÄ -->
            <img id="navi-image" src="Ìö®ÏõêÍ≥µÏõê.jpg" alt="ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò" style="width:100%; height:100%; object-fit:cover;">

            <!-- Îí§Î°úÍ∞ÄÍ∏∞ Î≤ÑÌäº (Ï¢åÏ∏° ÏÉÅÎã®) -->
            <div class="back-btn-common" onclick="goBackFromNavi()" style="position:absolute; top:20px; left:20px; z-index:10;"></div>
        </div>
    </div>

    <!-- 5. ÎßàÏù¥ÌéòÏù¥ÏßÄ -->
    <div id="page-mypage" class="content-area page">
        <!-- [NEW] ÎßàÏù¥ÌéòÏù¥ÏßÄ ÏÑ±Í≥º Ïπ¥Îìú (ÌîÑÎ°úÌïÑ Ìè¨Ìï®) -->
        <div class="performance-card">
            <!-- Î∞∞Í≤Ω Ïû•Ïãù (ÏΩîÏù∏ Ïù¥Î™®ÏßÄ) -->
            <div class="deco-coin top-left">ü™ô</div>
            <div class="deco-coin bottom-right">ü™ô</div>

            <!-- [NEW] ÌîÑÎ°úÌïÑ ÏÑπÏÖòÏùÑ Ïπ¥Îìú ÎÇ¥Î∂Ä ÏµúÏÉÅÎã®ÏúºÎ°ú Ïù¥Îèô -->
            <div class="mypage-profile">
                <div class="mypage-avatar">üë®‚Äçüíº</div>
                <div class="mypage-user-info">
                    <h1>ÍπÄÏîΩÌÅ¨ Îãò</h1>
                    <p>Ïò§ÎäòÎèÑ Ï¢ãÏùÄ ÏÑ±Í≥º Í∏∞ÎåÄÌï¥Ïöî!</p>
                </div>
                <div class="perf-refresh-inline">‚Üª</div>
            </div>

            <div class="perf-list">
                <!-- 1. ÌòÑÏû¨ Î≥¥Ïú† Ìè¨Ïù∏Ìä∏ -->
                <div class="perf-item" onclick="goToPage('ranking')">
                    <span class="perf-label">ÌòÑÏû¨ Î≥¥Ïú† Ìè¨Ïù∏Ìä∏</span>
                    <div class="perf-value-wrap">
                        <span class="perf-value highlight">350 P</span>
                        <span class="perf-arrow">‚Ä∫</span>
                    </div>
                </div>
                <!-- 2. Ïù¥Î≤à Ï£º ÌôúÎèô -->
                <div class="perf-item" onclick="goToPage('ranking')">
                    <span class="perf-label">Ïù¥Î≤à Ï£º ÌôúÎèô</span>
                    <div class="perf-value-wrap">
                        <span class="perf-value">12 Ìöå</span>
                        <span class="perf-arrow">‚Ä∫</span>
                    </div>
                </div>
                <!-- 3. ÌöçÎìù Î¶¨Îìú -->
                <div class="perf-item" onclick="goToPage('ranking')">
                    <span class="perf-label">ÌöçÎìù Î¶¨Îìú</span>
                    <div class="perf-value-wrap">
                        <span class="perf-value">8 Î™Ö</span>
                        <span class="perf-arrow">‚Ä∫</span>
                    </div>
                </div>
            </div>

            <!-- Ìè¨Ïù∏Ìä∏ Ï†ÅÎ¶Ω Í∏∞Ï§Ä -->
            <div class="perf-info">
                <div class="perf-info-title">üí° Ìè¨Ïù∏Ìä∏ Ï†ÅÎ¶Ω Í∏∞Ï§Ä</div>
                <div class="perf-info-list">
                    <div class="perf-info-item">
                        <span>Ï∂úÏÑù Ï≤¥ÌÅ¨</span>
                        <span>5 P</span>
                    </div>
                    <div class="perf-info-item">
                        <span>Ïã†Í∑ú ÏßÑÎã® / ÏÜåÏä§ ÌôïÎ≥¥</span>
                        <span>Í∞Å 20 P</span>
                    </div>
                    <div class="perf-info-item">
                        <span>ÏûÖÌöå ÏÑ±Í≥µ</span>
                        <span>50 P</span>
                    </div>
                    <div class="perf-info-item highlight">
                        <span>ÏùºÏùº ÎØ∏ÏÖò Î™®Îëê Îã¨ÏÑ± Ïãú</span>
                        <span>+100 P</span>
                    </div>
                </div>
            </div>

            <!-- Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö©Ï≤ò ÏïàÎÇ¥ -->
            <div class="perf-usage-msg">
                üéÅ <a href="https://m.woongjinmarket.com/mobile/index/index" target="_blank" style="color:inherit; text-decoration:none;">Î™®ÏúºÏã† Ìè¨Ïù∏Ìä∏Îäî <span class="underline">ÌåêÏ¥âÎ¨º</span>ÏùÑ Íµ¨Îß§Ìï† Ïàò ÏûàÏñ¥Ïöî!</a>
            </div>
        </div>

        <div class="section-title">ÏµúÍ∑º Î∞©Î¨∏ Ïù¥Î†•</div>
        <div id="history-list">
            <!-- ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ 1: Ìë∏Î•∏ÏÜî Í≥µÏõê -->
            <div class="place-card history-card" onclick="goToVisitResult(0)">
                <div class="place-img" style="background:#E8F5E9; color:#4CAF50;">üå≤</div>
                <div class="place-info">
                    <div class="place-name">Ìë∏Î•∏ÏÜî Í≥µÏõê</div>
                    <div class="place-time" style="color:#999;">Ïñ¥Ï†ú Î∞©Î¨∏ ¬∑ Î¶¨Îìú 3Î™Ö</div>
                </div>
                <div class="arrow-icon">‚Ä∫</div>
            </div>
            <!-- ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ 2: ÍøàÎÇòÎ¨¥ Ïú†ÏπòÏõê -->
            <div class="place-card history-card" onclick="goToVisitResult(1)">
                <div class="place-img" style="background:#FFF3E0; color:#FF9800;">üè´</div>
                <div class="place-info">
                    <div class="place-name">ÍøàÎÇòÎ¨¥ Ïú†ÏπòÏõê</div>
                    <div class="place-time" style="color:#999;">2Ïùº Ï†Ñ Î∞©Î¨∏ ¬∑ Î¶¨Îìú 2Î™Ö</div>
                </div>
                <div class="arrow-icon">‚Ä∫</div>
            </div>
            <!-- ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ 3: ÎßùÌè¨ Í∏ÄÎπõ ÎèÑÏÑúÍ¥Ä -->
            <div class="place-card history-card" onclick="goToVisitResult(2)">
                <div class="place-img" style="background:#F3E5F5; color:#9C27B0;">üìö</div>
                <div class="place-info">
                    <div class="place-name">ÎßùÌè¨ Í∏ÄÎπõ ÎèÑÏÑúÍ¥Ä</div>
                    <div class="place-time" style="color:#999;">3Ïùº Ï†Ñ Î∞©Î¨∏ ¬∑ Î¶¨Îìú 1Î™Ö</div>
                </div>
                <div class="arrow-icon">‚Ä∫</div>
            </div>
        </div>
    </div>

    <!-- 6. Î∞©Î¨∏ Í≤∞Í≥º ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ -->
    <div id="page-visit-result" class="content-area page">
        <!-- Í∑∏ÎùºÎîîÏñ∏Ìä∏ Ìó§Îçî -->
        <div class="visit-result-header">
            <div id="visit-result-icon" class="place-icon">üå≤</div>
            <div id="visit-result-title" class="place-title">Ìë∏Î•∏ÏÜî Í≥µÏõê</div>
        </div>

        <!-- ÎÇ†Ïßú Î∞è ÏãúÍ∞Ñ -->
        <div class="result-card">
            <div class="result-card-header">
                <div class="result-card-label">üìÖ ÎÇ†Ïßú Î∞è ÏãúÍ∞Ñ</div>
                <div class="result-card-edit" onclick="openModal('datetime')">ÏàòÏ†ï</div>
            </div>
            <div id="visit-date" class="result-card-value">2024ÎÖÑ 11Ïõî 24Ïùº</div>
            <div id="visit-time" class="result-card-value sub">14:00 ~ 16:30</div>
        </div>

        <!-- Î¶¨Îìú -->
        <div class="result-card">
            <div class="result-card-header">
                <div class="result-card-label">üë• Î¶¨Îìú</div>
                <div class="result-card-edit" onclick="openModal('leads')">ÏàòÏ†ï</div>
            </div>
            <div id="visit-leads" class="result-card-value" style="color:var(--secondary);">3Î™Ö</div>
        </div>

        <!-- Í≤∞Í≥º -->
        <div class="result-card">
            <div class="result-card-header">
                <div class="result-card-label">‚ú® Í≤∞Í≥º</div>
                <div class="result-card-edit" onclick="openModal('result')">ÏàòÏ†ï</div>
            </div>
            <div id="visit-result-status" class="result-status source">ÏÜåÏä§Îßå ÌôïÎ≥¥</div>
        </div>

        <!-- ÎπÑÍ≥† -->
        <div class="result-card">
            <div class="result-card-header">
                <div class="result-card-label">üìù ÎπÑÍ≥†</div>
                <div class="result-card-edit" onclick="openModal('note')">ÏàòÏ†ï</div>
            </div>
            <div id="visit-note" class="result-card-value sub" style="white-space:pre-wrap;">ÏïÑÏù¥ Îëê Î™Ö ÏóÑÎßà, ÍµêÏú°Ïóê Í¥ÄÏã¨ ÎßéÏùå.
Îã§ÏùåÏ£º ÏÉÅÎã¥ ÏòàÏ†ï.</div>
        </div>
    </div>

    <!-- Î™®Îã¨Îì§ -->
    <!-- ÎÇ†Ïßú/ÏãúÍ∞Ñ ÏàòÏ†ï Î™®Îã¨ -->
    <div id="modal-datetime" class="modal-overlay" onclick="closeModalOnOverlay(event, 'datetime')">
        <div class="modal-content">
            <div class="modal-title">üìÖ ÎÇ†Ïßú Î∞è ÏãúÍ∞Ñ ÏàòÏ†ï</div>
            <div class="modal-input-group">
                <label class="modal-input-label">ÎÇ†Ïßú</label>
                <input type="date" id="input-date" class="modal-input">
            </div>
            <div class="modal-input-group">
                <label class="modal-input-label">ÏãúÏûë ÏãúÍ∞Ñ</label>
                <input type="time" id="input-start-time" class="modal-input">
            </div>
            <div class="modal-input-group">
                <label class="modal-input-label">Ï¢ÖÎ£å ÏãúÍ∞Ñ</label>
                <input type="time" id="input-end-time" class="modal-input">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeModal('datetime')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" onclick="saveDatetime()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- Î¶¨Îìú ÏàòÏ†ï Î™®Îã¨ -->
    <div id="modal-leads" class="modal-overlay" onclick="closeModalOnOverlay(event, 'leads')">
        <div class="modal-content">
            <div class="modal-title">üë• Î¶¨Îìú ÏàòÏ†ï</div>
            <div class="modal-input-group">
                <label class="modal-input-label">Î¶¨Îìú Ïàò (Î™Ö)</label>
                <input type="number" id="input-leads" class="modal-input" min="0" placeholder="0">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeModal('leads')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" onclick="saveLeads()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- Í≤∞Í≥º ÏàòÏ†ï Î™®Îã¨ -->
    <div id="modal-result" class="modal-overlay" onclick="closeModalOnOverlay(event, 'result')">
        <div class="modal-content">
            <div class="modal-title">‚ú® Í≤∞Í≥º ÏÑ†ÌÉù</div>
            <div class="result-options">
                <div class="result-option" data-value="none" onclick="selectResultOption(this)">
                    <div class="result-option-icon" style="background:#F5F5F5;">‚≠ï</div>
                    <div class="result-option-text">ÏóÜÏùå</div>
                </div>
                <div class="result-option" data-value="source" onclick="selectResultOption(this)">
                    <div class="result-option-icon" style="background:#E3F2FD;">üìã</div>
                    <div class="result-option-text">ÏÜåÏä§Îßå ÌôïÎ≥¥</div>
                </div>
                <div class="result-option" data-value="success" onclick="selectResultOption(this)">
                    <div class="result-option-icon" style="background:#E8F5E9;">üéâ</div>
                    <div class="result-option-text">Í≥ÑÏïΩ ÏÑ±Í≥µ</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeModal('result')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" onclick="saveResult()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- ÎπÑÍ≥† ÏàòÏ†ï Î™®Îã¨ -->
    <div id="modal-note" class="modal-overlay" onclick="closeModalOnOverlay(event, 'note')">
        <div class="modal-content">
            <div class="modal-title">üìù ÎπÑÍ≥† ÏàòÏ†ï</div>
            <div class="modal-input-group">
                <label class="modal-input-label">ÌäπÏù¥ÏÇ¨Ìï≠ Î©îÎ™®</label>
                <textarea id="input-note" class="modal-textarea" placeholder="Î∞©Î¨∏ Ïãú ÌäπÏù¥ÏÇ¨Ìï≠ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeModal('note')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" onclick="saveNote()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- ÏùºÏ†ï ÏàòÏ†ï Î™®Îã¨ -->
    <div id="modal-schedule" class="modal-overlay" onclick="closeModalOnOverlay(event, 'schedule')">
        <div class="modal-content">
            <div class="modal-title">üìù ÏùºÏ†ï ÏàòÏ†ï</div>
            <div class="modal-input-group">
                <label class="modal-input-label">ÏãúÍ∞Ñ</label>
                <input type="text" id="input-schedule-time" class="modal-input" readonly style="background:#f5f5f5; color:#999;">
            </div>
            <div class="modal-input-group">
                <label class="modal-input-label">ÏùºÏ†ï ÎÇ¥Ïö©</label>
                <input type="text" id="input-schedule-text" class="modal-input" placeholder="ÏùºÏ†ï ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">
            </div>
            <div class="modal-input-group">
                <label class="modal-input-label">Ïû•ÏÜå (ÏÑ†ÌÉù)</label>
                <input type="text" id="input-schedule-location" class="modal-input" placeholder="Ïòà: üìç ÏÇºÏÑ±1Ï∞®">
            </div>
            <div class="modal-buttons" style="flex-wrap:wrap; gap:8px;">
                <button class="modal-btn cancel" onclick="closeModal('schedule')">Ï∑®ÏÜå</button>
                <button class="modal-btn" onclick="setScheduleFree()" style="background:#FF9800; color:white;">ÏùºÏ†ïÏóÜÏùå</button>
                <button class="modal-btn save" onclick="saveSchedule()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- iOS ÌôàÌôîÎ©¥ Ï∂îÍ∞Ä ÏïàÎÇ¥ Î™®Îã¨ -->
    <div id="modal-ios-install" class="modal-overlay" onclick="closeModal('ios-install')">
        <div class="modal-content" style="padding:16px; max-width:320px;" onclick="event.stopPropagation()">
            <img src="add_home.png" alt="ÌôàÌôîÎ©¥ Ï∂îÍ∞Ä Î∞©Î≤ï" style="width:100%; border-radius:12px;">
            <button class="modal-btn save" onclick="closeModal('ios-install')" style="width:100%; margin-top:12px;">ÌôïÏù∏</button>
        </div>
    </div>

    <!-- 6. Îû≠ÌÇπ ÌéòÏù¥ÏßÄ -->
    <div id="page-ranking" class="content-area page">
        <!-- Top 3 Ìè¨ÎîîÏõÄ -->
        <div class="ranking-podium">
            <!-- 2ÏúÑ -->
            <div class="podium-item podium-2">
                <div class="rank-avatar">ü•à</div>
                <div class="rank-box">
                    <div class="rank-num">2</div>
                    <div class="rank-name">ÎßàÏõÖÏßÑ</div>
                    <div class="rank-group">ÎßàÍ≥°71ÏßÄÏó≠Íµ≠</div>
                    <div class="rank-score">510pt</div>
                </div>
            </div>
            <!-- 1ÏúÑ -->
            <div class="podium-item podium-1">
                <div class="rank-crown">üëë</div>
                <div class="rank-avatar">ü•á</div>
                <div class="rank-box">
                    <div class="rank-num">1</div>
                    <div class="rank-name">ÏàòÏõÖÏßÑ</div>
                    <div class="rank-group">ÏàòÏõê11ÏßÄÏó≠Íµ≠</div>
                    <div class="rank-score">520pt</div>
                </div>
            </div>
            <!-- 3ÏúÑ -->
            <div class="podium-item podium-3">
                <div class="rank-avatar">ü•â</div>
                <div class="rank-box">
                    <div class="rank-num">3</div>
                    <div class="rank-name">Í≥†ÏõÖÏßÑ</div>
                    <div class="rank-group">Í≥†Ïñë31ÏßÄÏó≠Íµ≠</div>
                    <div class="rank-score">480pt</div>
                </div>
            </div>
        </div>

        <!-- 4~10ÏúÑ Î¶¨Ïä§Ìä∏ -->
        <div class="ranking-list">
            <div class="rank-row">
                <div class="r-rank">4</div>
                <div class="r-info">
                    <span class="r-name">Ï≤úÏõÖÏßÑ</span>
                    <span class="r-group">Ï≤úÏïàÌÉïÏ†ïÏÇ¨ÏóÖÍµ≠</span>
                </div>
                <div class="r-score">475pt</div>
            </div>
            <div class="rank-row">
                <div class="r-rank">5</div>
                <div class="r-info">
                    <span class="r-name">Ïó¨ÏõÖÏßÑ</span>
                    <span class="r-group">Ïó¨ÏàòÏÇ¨ÏóÖÍµ≠</span>
                </div>
                <div class="r-score">460pt</div>
            </div>
            <div class="rank-row">
                <div class="r-rank">6</div>
                <div class="r-info">
                    <span class="r-name">Ìè¨ÏõÖÏßÑ</span>
                    <span class="r-group">Ìè¨Ìï≠ÏÇ¨ÏóÖÍµ≠</span>
                </div>
                <div class="r-score">420pt</div>
            </div>
            <div class="rank-row">
                <div class="r-rank">7</div>
                <div class="r-info">
                    <span class="r-name">Î∂ÄÏõÖÏßÑ</span>
                    <span class="r-group">Î∂ÄÏÇ∞ÎèôÎ∂ÄÏßÅÌï†ÏÇ¨ÏóÖÍµ≠</span>
                </div>
                <div class="r-score">405pt</div>
            </div>
            <div class="rank-row">
                <div class="r-rank">8</div>
                <div class="r-info">
                    <span class="r-name">Ï†úÏõÖÏßÑ</span>
                    <span class="r-group">Ï†úÏ£ºÎÇ®Î∂ÄÏÇ¨ÏóÖÍµ≠</span>
                </div>
                <div class="r-score">395pt</div>
            </div>
            <div class="rank-row">
                <div class="r-rank">9</div>
                <div class="r-info">
                    <span class="r-name">Ïö©ÏõÖÏßÑ</span>
                    <span class="r-group">Ïö©Ïù∏ÏÇ¨ÏóÖÍµ≠</span>
                </div>
                <div class="r-score">380pt</div>
            </div>
            <div class="rank-row">
                <div class="r-rank">10</div>
                <div class="r-info">
                    <span class="r-name">Ïö©ÏõÖÏßÑ</span>
                    <span class="r-group">Ïö©ÏÇ∞ÎßàÌè¨ÏÇ¨ÏóÖÍµ≠</span>
                </div>
                <div class="r-score">370pt</div>
            </div>
        </div>
    </div>

    <!-- [NEW] Ïò§Îäò ÌôúÎèô ÏôÑÎ£å Î¶¨Ìè¨Ìä∏ ÌéòÏù¥ÏßÄ -->
    <div id="page-finish">
        <!-- Î£®ÎØ∏ ÏñºÍµ¥ -->
        <div class="lumi-container" style="opacity:0; transform: translateY(20px);">
            <img src="LUMI_front_full.png" alt="Lumi" style="width:160px; height:160px; border-radius:50%; border:5px solid var(--primary); box-shadow: var(--shadow-float); object-fit: cover;">
        </div>

        <!-- Î¶¨Ìè¨Ìä∏ ÌÖçÏä§Ìä∏ -->
        <div class="report-text-container" style="text-align:center; margin-top:30px; width:100%;">

            <!-- 1. ÌÉÄÏù¥ÌãÄ -->
            <p class="report-line line-1" style="font-size:22px; font-weight:800; margin-bottom:16px; display:none; color:var(--text-title);">
                Ïò§Îäò Îã¨ÏÑ±Ìïú ÏÑ±Í≥ºÏïº ‚ú®
            </p>

            <!-- 2. ÏÑ±Í≥º Î∞ïÏä§ -->
            <div class="report-box line-2" style="background:#f5f7f6; padding:20px; border-radius:20px; margin:0 auto 24px auto; width:80%; display:none; box-shadow:var(--shadow-sm);">
                <p style="margin:6px 0; font-size:17px; font-weight:600; color:#2C3E50;">‚úÖ Ïã†Í∑ú ÏÜåÏä§ 2Í∞ú ÌôïÎ≥¥</p>
                <p style="margin:6px 0; font-size:17px; font-weight:600; color:#2C3E50;">‚úÖ Ïã†Í∑ú ÏßÑÎã® 1Í∞ú ÌôïÎ≥¥</p>
            </div>

            <!-- 3. Ïπ≠Ï∞¨ -->
            <p class="report-line line-3" style="color:var(--primary); font-size:18px; font-weight:700; display:none; margin-bottom:30px;">
                Ïñ¥Ï†úÎ≥¥Îã§ Îçî ÎßéÏù¥ Îã¨ÏÑ±ÌñàÎäîÎç∞? üò≤
            </p>

            <!-- 4. ÎÇ¥Ïùº Ï∂îÏ≤ú -->
            <p class="report-line line-4" style="font-size:16px; line-height:1.6; color:#555; display:none;">
                ÎÇ¥ÏùºÏùÄ <span style="background:#FFE0B2; padding:2px 8px; border-radius:8px; font-weight:bold; color:#E65100;">Îß§ÌÉÑÏ¥àÎì±ÌïôÍµê</span> ÏïûÏùÑ<br>Î∞©Î¨∏Ìï¥ Î≥¥Ïûê.
            </p>

            <!-- 5. ÎßàÎ¨¥Î¶¨ -->
            <p class="report-line line-5" style="margin-top:40px; font-size:26px; font-weight:800; color:var(--text-title); display:none;">
                Ïò§ÎäòÎèÑ Ï†ïÎßê Í≥†ÏÉùÌñàÏñ¥! üíñ
            </p>
        </div>

        <!-- ÌôàÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞ Î≤ÑÌäº -->
        <button class="btn-close-report" onclick="closeDailyReport()" style="margin-top:50px; display:none; background:var(--primary); color:white; border:none; padding:14px 40px; border-radius:30px; font-size:16px; font-weight:bold; box-shadow:0 4px 15px rgba(74, 110, 93, 0.3); cursor:pointer; transition:transform 0.2s;">
            ÌôàÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞ üè†
        </button>
    </div>

    <!-- ÌîåÎ°úÌåÖ Ï±óÎ¥á Î≤ÑÌäº (LUMI) -->
    <div class="floating-chat-btn" onclick="openChatBot()"></div>

</div>

<script>
    /* UI Interaction Scripts */

    // ÎûúÎç§ Ìï´Ïä§Ìåü ÏÑ†ÌÉù
    function updateRandomHotspot() {
        const placeNames = ['Ìö®ÏõêÍ≥µÏõê', 'ÌåêÌÉÄÏßÄÏõÄ', 'ÏïÑÏù¥ÌååÌÅ¨ Ï∫êÏä¨', 'ÎßùÌè¨ Í∏ÄÎπõ ÎèÑÏÑúÍ¥Ä', 'Î∏åÎü∞Ïπò Îπà'];
        const randomIndex = Math.floor(Math.random() * placeNames.length);
        const selectedPlace = placeNames[randomIndex];
        const detail = placeDetails[selectedPlace];

        if (detail) {
            // ÏïÑÏù¥ÏΩò ÏóÖÎç∞Ïù¥Ìä∏
            const hotspotIcon = document.getElementById('hotspot-icon');
            if (hotspotIcon) {
                hotspotIcon.textContent = detail.icon;
            }

            // Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏
            const hotspotName = document.getElementById('hotspot-name');
            if (hotspotName) {
                hotspotName.textContent = detail.name;
            }

            // Ïπ¥Îìú ÌÅ¥Î¶≠ Ïãú Ìï¥Îãπ Ïû•ÏÜå ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÎèÑÎ°ù ÏÑ§Ï†ï
            const hotspotCard = document.getElementById('hotspot-card');
            if (hotspotCard) {
                hotspotCard.onclick = () => goToPlaceDetail(selectedPlace);
            }
        }
    }

    // ÌéòÏù¥ÏßÄ ÌûàÏä§ÌÜ†Î¶¨ Í¥ÄÎ¶¨
    let pageHistory = ['home'];

    // Îí§Î°úÍ∞ÄÍ∏∞ ÌïÑÏöîÌïú ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄÎì§
    const detailPages = ['place-detail', 'visit-result', 'recommend', 'chat'];

    // Ï∂îÏ≤ú Ïû•ÏÜå Îç∞Ïù¥ÌÑ∞
    const recommendPlacesData = [
        { name: 'Ìö®ÏõêÍ≥µÏõê', icon: 'üå≤', iconBg: '#E8F5E9', iconColor: '#4CAF50', desc: 'ÌïòÏõê ÌõÑ ÏóêÎÑàÏßÄ ÎÑòÏπòÎäî ÏïÑÏù¥Îì§ ÏßëÍ≤∞' },
        { name: 'ÌåêÌÉÄÏßÄÏõÄ', icon: 'üè∞', iconBg: '#FFF3E0', iconColor: '#FF9800', desc: 'ÏÜåÎπÑÎ†• ÎÜíÏùÄ ÏòÅÌÜµ ÎßòÎì§Ïùò ÏÑ±ÏßÄ' },
        { name: 'ÏïÑÏù¥ÌååÌÅ¨ Ï∫êÏä¨ 1Îã®ÏßÄ', detailName: 'ÏïÑÏù¥ÌååÌÅ¨ Ï∫êÏä¨', icon: 'üöå', iconBg: '#E3F2FD', iconColor: '#2196F3', desc: 'ÏÖîÌãÄÎ≤ÑÏä§ ÏßëÍ≤∞ÏßÄ, Îì±ÌïòÏõê ÏãúÍ∞Ñ ÏµúÏ†Å' },
        { name: 'ÎßùÌè¨ Í∏ÄÎπõ ÎèÑÏÑúÍ¥Ä', icon: 'üìö', iconBg: '#F3E5F5', iconColor: '#9C27B0', desc: 'ÍµêÏú°Ïó¥ ÎÜíÏùÄ Î∂ÄÎ™®Îãò ÎåÄÌôî Í∞ÄÎä•' },
        { name: 'Î∏åÎü∞Ïπò Îπà (Ïπ¥ÌéòÍ±∞Î¶¨)', detailName: 'Î∏åÎü∞Ïπò Îπà', icon: '‚òï', iconBg: '#FBE9E7', iconColor: '#FF5722', desc: 'Ïò§Ï†Ñ 10~12Ïãú ÏóÑÎßàÎì§ Î™®ÏûÑ Ïû•ÏÜå' }
    ];

    // Î∞∞Ïó¥ ÏÖîÌîå Ìï®Ïàò
    function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }

    // Ï∂îÏ≤ú Ïû•ÏÜå ÎûúÎç§ Î†åÎçîÎßÅ
    function renderRandomPlaces() {
        const container = document.getElementById('recommend-places-list');
        const shuffledPlaces = shuffleArray(recommendPlacesData);

        container.innerHTML = shuffledPlaces.map(place => `
            <div class="place-card" onclick="goToPlaceDetail('${place.detailName || place.name}')">
                <div class="place-img" style="background:${place.iconBg}; color:${place.iconColor};">${place.icon}</div>
                <div class="place-info">
                    <div class="place-name">${place.name}</div>
                    <div class="place-time sparkle">${place.desc}</div>
                </div>
                <div class="btn-go">Go</div>
            </div>
        `).join('');
    }

    // ÌéòÏù¥ÏßÄ Ïù¥Îèô
    function goToPage(pageId) {
        // ÌéòÏù¥ÏßÄ Ï†ÑÌôò
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');

        // ÏÉÅÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌôúÏÑ±Ìôî ÏÉÅÌÉú Î≥ÄÍ≤Ω
        document.querySelectorAll('.nav-text-item').forEach(item => {
            item.classList.remove('active');
            item.style.color = 'var(--text-caption)';
        });

        // ÌÅ¥Î¶≠Ìïú Î©îÎâ¥ ÌôúÏÑ±Ìôî
        const navMap = {'home':0, 'mypage':1, 'ranking':2, 'recommend':0, 'chat':0};
        const navItems = document.querySelectorAll('.nav-text-item');
        if(navItems[navMap[pageId]] !== undefined) {
            navItems[navMap[pageId]].classList.add('active');
            navItems[navMap[pageId]].style.color = 'var(--primary)';
        }

        // Îí§Î°úÍ∞ÄÍ∏∞ Î≤ÑÌäº ÌëúÏãú/Ïà®ÍπÄ
        const backBtn = document.getElementById('header-back-btn');
        if (detailPages.includes(pageId)) {
            backBtn.style.visibility = 'visible';
        } else {
            backBtn.style.visibility = 'hidden';
        }

        // ÌûàÏä§ÌÜ†Î¶¨ Í¥ÄÎ¶¨ (Î©îÏù∏ ÌéòÏù¥ÏßÄÎ©¥ ÌûàÏä§ÌÜ†Î¶¨ Ï¥àÍ∏∞Ìôî)
        if (['home', 'mypage', 'ranking'].includes(pageId)) {
            pageHistory = [pageId];
        } else {
            pageHistory.push(pageId);
        }

        // ÌîåÎ°úÌåÖ LUMI Î≤ÑÌäº ÌëúÏãú/Ïà®ÍπÄ (Ï±ÑÌåÖ ÌéòÏù¥ÏßÄÏóêÏÑúÎäî Ïà®ÍπÄ)
        const floatingBtn = document.querySelector('.floating-chat-btn');
        if (floatingBtn) {
            floatingBtn.style.display = (pageId === 'chat') ? 'none' : 'flex';
        }

        // Ï±ÑÌåÖ ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî (ÌôúÎèô GOÏóêÏÑú ÏßÑÏûÖ Ïãú Ïä§ÌÇµ)
        if(pageId === 'chat' && !window.skipInitChat) {
            initChat();
        }
        window.skipInitChat = false; // ÌîåÎûòÍ∑∏ Ï¥àÍ∏∞Ìôî

        // Ï∂îÏ≤ú ÌéòÏù¥ÏßÄ ÏßÑÏûÖ Ïãú Ïû•ÏÜå Ïπ¥Îìú ÎûúÎç§ Î†åÎçîÎßÅ
        if(pageId === 'recommend') {
            renderRandomPlaces();
        }
    }

    // Îí§Î°úÍ∞ÄÍ∏∞
    function goBack() {
        if (pageHistory.length > 1) {
            pageHistory.pop(); // ÌòÑÏû¨ ÌéòÏù¥ÏßÄ Ï†úÍ±∞
            const prevPage = pageHistory[pageHistory.length - 1];
            goToPage(prevPage);
        } else {
            goToPage('home');
        }
    }

    // Ïû•ÏÜåÎ≥Ñ ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Îç∞Ïù¥ÌÑ∞
    const placeDetails = {
        'Ìö®ÏõêÍ≥µÏõê': {
            icon: 'üå≤',
            name: 'Ìö®ÏõêÍ≥µÏõê',
            naviImage: 'Ìö®ÏõêÍ≥µÏõê.jpg',
            mapImage: 'Ìö®ÏõêÍ≥µÏõê_map.jpg',
            distance: '350m',
            time: '5Î∂Ñ',
            message1: 'Ïûê, Ïñ¥Ï†ú AÎã®ÏßÄÎäî Í∞îÏóàÏ£†?<br />Ïò§ÎäòÏùÄ <strong style="color:var(--primary);">Ìö®ÏõêÍ≥µÏõê</strong>ÏûÖÎãàÎã§. Ïó¨Í∏¥ ÏßÄÍ∏à <strong style="color:#FF9800;">Ï¥àÎì±ÏÉù ÌïòÍµê ÏãúÍ∞Ñ</strong>Ïù¥Îùº ÏóÑÎßàÎì§Ïù¥ Ï†úÏùº ÎßéÏù¥ Î™®Ïó¨ ÏûàÏñ¥Ïöî!',
            hasEvent: true,
            eventTitle: 'ÏïåÎú∞Ïû•ÌÑ∞ ÎÇ†',
            eventInfo: {
                event: 'C ÏïÑÌååÌä∏ ÏïåÎú∞Ïû•ÌÑ∞ Ïó¥Î¶º',
                contact: '010-3456-7890',
                checklist: ['ÌÖåÏù¥Î∏î 1Í∞ú', 'ÌåêÏ¥âÎ¨º 50Í∞ú', 'Î™ÖÌï® & Î¶¨ÌîåÎ†õ']
            },
            tips: '‚Ä¢ Ïò§ÌõÑ 2Ïãú~4Ïãú: ÌïòÍµê ÏãúÍ∞Ñ ÏßëÏ§ë Í≥µÎûµ<br />‚Ä¢ Ïò§ÌõÑ 4Ïãú~6Ïãú: ÏïåÎú∞Ïû•ÌÑ∞ Î∞©Î¨∏Í∞ù ÎåÄÏÉÅ'
        },
        'ÌåêÌÉÄÏßÄÏõÄ': {
            icon: 'üè∞',
            name: 'ÌåêÌÉÄÏßÄÏõÄ',
            naviImage: 'ÎçîÌåêÌÉÄÏßÄÏõÄ.jpg',
            mapImage: 'ÎçîÌåêÌÉÄÏßÄÏõÄ_map.jpg',
            distance: '420m',
            time: '6Î∂Ñ',
            message1: 'ÌåêÌÉÄÏßÄÏõÄÏùÄ <strong style="color:var(--primary);">ÌÇ§Ï¶àÏπ¥Ìéò, Î≥ëÏõê, ÏáºÌïëÎ™∞</strong>Ïù¥ Î™®Îëê Î™®Ïó¨ÏûàÎäî ÏòÅÌÜµ ÎßòÎì§Ïùò Ìï´ÌîåÎ†àÏù¥Ïä§ÏòàÏöî!<br />ÏÜåÎπÑÎ†•Ïù¥ ÎÜíÏùÄ Í≥†Í∞ùÎì§ÏùÑ ÎßåÎÇ† Ïàò ÏûàÎäî ÏµúÏ†ÅÏùò Ïû•ÏÜåÏûÖÎãàÎã§.',
            hasEvent: false,
            specialInfo: {
                title: 'Ï£ºÏöî ÌÉÄÍ≤ü',
                items: [
                    'üë®\u200düë©\u200düëß\u200düë¶ 3~7ÏÑ∏ ÏûêÎÖÄÎ•º Îëî Í∞ÄÏ°±',
                    'üí∞ Ïõî ÏÜåÎìù ÏÉÅÏúÑ 30% Ïù¥ÏÉÅ',
                    'üè• ÏÜåÏïÑÍ≥º ÎåÄÍ∏∞ Ï§ëÏù∏ Î∂ÄÎ™®Îãò'
                ]
            },
            tips: '‚Ä¢ Ïò§Ï†Ñ 10Ïãú~12Ïãú: ÌÇ§Ï¶àÏπ¥Ìéò Ïù¥Ïö© Í∞ÄÏ°±<br />‚Ä¢ Ïò§ÌõÑ 2Ïãú~5Ïãú: ÏÜåÏïÑÍ≥º ÎåÄÍ∏∞Ïã§ Í≥µÎûµ'
        },
        'ÏïÑÏù¥ÌååÌÅ¨ Ï∫êÏä¨': {
            icon: 'üöå',
            name: 'ÏïÑÏù¥ÌååÌÅ¨ Ï∫êÏä¨ 1Îã®ÏßÄ',
            naviImage: 'ÏïÑÏù¥ÌååÌÅ¨Ï∫êÏä¨.jpg',
            mapImage: 'ÏïÑÏù¥ÌååÌÅ¨Ï∫êÏä¨_map.jpg',
            distance: '280m',
            time: '4Î∂Ñ',
            message1: 'ÏïÑÏù¥ÌååÌÅ¨ Ï∫êÏä¨ÏùÄ <strong style="color:var(--primary);">Ïú†ÏπòÏõê¬∑ÌïôÏõê ÏÖîÌãÄÎ≤ÑÏä§</strong>Í∞Ä ÏßëÍ≤∞ÌïòÎäî Í≥≥Ïù¥ÏóêÏöî!<br />Í∑ºÏ≤òÏóê <strong style="color:#FF9800;">ÍøàÎÇòÎ¨¥ Ïú†ÏπòÏõê, Ìï¥Îãò Ïñ¥Î¶∞Ïù¥Ïßë</strong>Ïù¥ ÏûàÏñ¥ÏÑú Ïñ¥Î®∏ÎãàÎì§Ïù¥ ÏïÑÏù¥Îì§Ïùò ÌïòÏõêÏùÑ Í∏∞Îã§Î¶¨Í≥† ÏûàÏñ¥Ïöî.',
            hasEvent: false,
            specialInfo: {
                title: 'ÌïòÏõê ÏãúÍ∞ÑÌëú',
                items: [
                    'üöå ÍøàÎÇòÎ¨¥ Ïú†ÏπòÏõê: 14:00, 16:00',
                    'üöå Ìï¥Îãò Ïñ¥Î¶∞Ïù¥Ïßë: 14:30, 15:30',
                    'üìö ÏòÅÏñ¥ÌïôÏõê: 15:00, 17:00'
                ]
            },
            tips: '‚Ä¢ Ïò§ÌõÑ 1Ïãú 30Î∂Ñ~2Ïãú: Ï≤´ ÌïòÏõê ÎåÄÍ∏∞<br />‚Ä¢ Ïò§ÌõÑ 3Ïãú~4Ïãú: ÌîºÌÅ¨ ÌÉÄÏûÑ ÏßëÏ§ë Í≥µÎûµ'
        },
        'ÎßùÌè¨ Í∏ÄÎπõ ÎèÑÏÑúÍ¥Ä': {
            icon: 'üìö',
            name: 'ÎßùÌè¨ Í∏ÄÎπõ ÎèÑÏÑúÍ¥Ä',
            naviImage: 'ÎßùÌè¨Í∏ÄÎπõÎèÑÏÑúÍ¥Ä.jpg',
            mapImage: 'ÎßùÌè¨Í∏ÄÎπõÎèÑÏÑúÍ¥Ä_map.jpg',
            distance: '520m',
            time: '7Î∂Ñ',
            message1: 'ÎßùÌè¨ Í∏ÄÎπõ ÎèÑÏÑúÍ¥ÄÏùÄ <strong style="color:var(--primary);">ÍµêÏú°Ïó¥Ïù¥ ÎÜíÏùÄ Î∂ÄÎ™®ÎãòÎì§</strong>Ïù¥ ÏïÑÏù¥Îì§Í≥º Ìï®Íªò Î∞©Î¨∏ÌïòÎäî Í≥≥Ïù¥ÏóêÏöî!<br /><strong style="color:#FF9800;">ÌïôÏäµ Í¥ÄÎ†® ÎåÄÌôî</strong>Í∞Ä ÏûêÏó∞Ïä§ÎüΩÍ≤å ÌÜµÌïòÎäî ÌÉÄÍ≤üÏ∏µÏûÖÎãàÎã§.',
            hasEvent: false,
            specialInfo: {
                title: 'Ï†ëÍ∑º Ìè¨Ïù∏Ìä∏',
                items: [
                    'üìñ 1Ï∏µ Ïñ¥Î¶∞Ïù¥ Ïó¥ÎûåÏã§ Ïïû',
                    '‚òï Ïπ¥ÌéòÌÖåÎ¶¨ÏïÑ (ÌïôÎ∂ÄÎ™® Ìú¥Í≤å Í≥µÍ∞Ñ)',
                    'üé® Î¨∏Ìôî Í∞ïÏ¢åÏã§ (ÏòÅÏñ¥/ÎØ∏Ïà† ÏàòÏóÖ)'
                ]
            },
            tips: '‚Ä¢ Ïò§Ï†Ñ 10Ïãú~12Ïãú: ÏòÅÏú†ÏïÑ ÌîÑÎ°úÍ∑∏Îû® Ï∞∏Ïó¨ Í∞ÄÏ°±<br />‚Ä¢ Ïò§ÌõÑ 3Ïãú~6Ïãú: Ï¥àÎì±ÏÉù ÏûêÍ∏∞Ï£ºÎèÑÌïôÏäµ ÌïôÎ∂ÄÎ™®'
        },
        'Î∏åÎü∞Ïπò Îπà': {
            icon: '‚òï',
            name: 'Î∏åÎü∞Ïπò Îπà (Ïπ¥ÌéòÍ±∞Î¶¨)',
            naviImage: 'Î∏åÎü∞ÏπòÎπà.jpg',
            mapImage: 'Î∏åÎü∞ÏπòÎπà_map.jpg',
            distance: '380m',
            time: '5Î∂Ñ',
            message1: 'Î∏åÎü∞Ïπò ÎπàÏùÄ <strong style="color:var(--primary);">Ïò§Ï†Ñ 10~12Ïãú</strong> ÏÇ¨Ïù¥ ÏóÑÎßàÎì§Ïùò Î™®ÏûÑ Ïû•ÏÜåÎ°ú Ïú†Î™ÖÌï¥Ïöî!<br />Í∑ºÏ≤òÏóê <strong style="color:#FF9800;">ÏöîÍ∞ÄÌïôÏõê, ÌïÑÎùºÌÖåÏä§</strong>Í∞Ä ÏûàÏñ¥ÏÑú Ïö¥Îèô ÌõÑ Ï∞® ÌïúÏûî ÌïòÎü¨ Ïò§ÏãúÎäî Î∂ÑÎì§Ïù¥ ÎßéÏïÑÏöî.',
            hasEvent: false,
            specialInfo: {
                title: 'Ï†ëÍ∑º Ï†ÑÎûµ',
                items: [
                    '‚òï ÌÖåÎùºÏä§ Ï¢åÏÑù (ÏïºÏô∏ÏóêÏÑú Ï†ëÍ∑º)',
                    'ü•ê Î∏åÎü∞Ïπò ÌÉÄÏûÑ (10:30~12:00)',
                    'üßò\u200d‚ôÄÔ∏è ÏöîÍ∞Ä/ÌïÑÎùºÌÖåÏä§ ÏàòÏóÖ Ï¢ÖÎ£å ÏãúÍ∞Ñ Ï≤¥ÌÅ¨'
                ]
            },
            tips: '‚Ä¢ Ïò§Ï†Ñ 10Ïãú~11Ïãú: Ïö¥Îèô ÎßàÏπú ÏóÑÎßàÎì§<br />‚Ä¢ Ïò§Ï†Ñ 11Ïãú~12Ïãú: Î∏åÎü∞Ïπò Î™®ÏûÑ ÌîºÌÅ¨ÌÉÄÏûÑ'
        }
    };

    // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Ïû•ÏÜåÎ•º Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú Ï†ÄÏû•
    window.currentPlace = null;
    window.previousPage = 'recommend'; // ÎÑ§ÎπÑ ÌôîÎ©¥ÏóêÏÑú ÎèåÏïÑÍ∞à ÌéòÏù¥ÏßÄ Ï†ÄÏû•

    // Ïû•ÏÜå ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
    function goToPlaceDetail(placeName) {
        const detail = placeDetails[placeName];
        if (!detail) return;

        // ÌòÑÏû¨ Ïû•ÏÜå Ï†ÄÏû•
        window.currentPlace = placeName;

        // ÌéòÏù¥ÏßÄ ÎÇ¥Ïö© ÏóÖÎç∞Ïù¥Ìä∏
        const detailPage = document.getElementById('page-place-detail');

        // Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('place-detail-title').textContent = detail.name;

        // ÏßÄÎèÑ Ïù¥ÎØ∏ÏßÄ + ÌïÄ ÎßàÏª§ ÏóÖÎç∞Ïù¥Ìä∏
        const imageContainer = document.getElementById('place-image-container');
        if (detail.mapImage) {
            imageContainer.innerHTML = `
                <img src="${detail.mapImage}" alt="${detail.name} ÏßÄÎèÑ" style="width:100%; height:100%; object-fit:cover;">
                <div class="map-pin">üìç</div>`;
        } else {
            imageContainer.innerHTML = `
                <div style="text-align:center;">
                    <div style="font-size:48px; margin-bottom:8px; opacity:0.4;">üìç</div>
                    <div style="font-size:14px; color:var(--text-caption); opacity:0.6;">Ïû•ÏÜå Ïù¥ÎØ∏ÏßÄ ÏòÅÏó≠</div>
                </div>`;
        }

        // Í±∞Î¶¨/ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
        const distanceCards = detailPage.querySelectorAll('.place-info-grid > div');
        distanceCards[0].querySelector('div:last-child').textContent = `ÏïΩ ${detail.distance}`;
        distanceCards[1].querySelector('div:last-child').textContent = `ÏïΩ ${detail.time}`;

        // AI Î©îÏãúÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
        detailPage.querySelector('.ai-message').innerHTML = `<p style="font-size:15px; color:var(--text-body); line-height:1.6;">${detail.message1}</p>`;

        // Ïù¥Î≤§Ìä∏/ÌäπÎ≥Ñ Ï†ïÎ≥¥ ÏÑπÏÖò ÏóÖÎç∞Ïù¥Ìä∏
        const eventSection = detailPage.querySelector('.event-section');
        if (detail.hasEvent) {
            eventSection.style.display = 'block';
            eventSection.innerHTML = `
                <p style="font-size:15px; color:#F57F17; line-height:1.6; margin-bottom:16px;">
                    Í≤åÎã§Í∞Ä Ïò§Îäò Í±∞Í∏¥ <strong>${detail.eventTitle}</strong>Ïù¥ÏóêÏöî!<br />
                    Ïû•ÌÑ∞ ÌåÄÏû•Îãò Î≤àÌò∏ ÎùÑÏõåÎìúÎ¶¥ ÌÖåÎãà ÏûêÎ¶¨Î∂ÄÌÑ∞ Ïû°ÏúºÏÑ∏Ïöî. ÌåêÏ¥âÎ¨º Ï±ôÍ∏∞ÏÖ®Ï£†?
                </p>
                <div style="background:rgba(255,255,255,0.9); border-radius:16px; padding:16px;">
                    <div style="display:flex; align-items:start; gap:12px; padding-bottom:12px; border-bottom:1px solid #F0F0F0;">
                        <div style="font-size:20px;">üö©</div>
                        <div style="flex:1;">
                            <div style="font-size:13px; color:var(--text-caption); margin-bottom:4px;">Ïò§ÎäòÏùò Ïù¥Î≤§Ìä∏</div>
                            <div style="font-size:15px; color:var(--text-title);">${detail.eventInfo.event}</div>
                        </div>
                    </div>
                    <div style="display:flex; align-items:start; gap:12px; padding:12px 0; border-bottom:1px solid #F0F0F0;">
                        <div style="font-size:20px;">üìû</div>
                        <div style="flex:1;">
                            <div style="font-size:13px; color:var(--text-caption); margin-bottom:4px;">Ïû•ÌÑ∞ ÌåÄÏû•Îãò</div>
                            <div style="font-size:15px; color:var(--primary); display:flex; align-items:center; gap:8px;">
                                ${detail.eventInfo.contact}
                                <a href="tel:${detail.eventInfo.contact}" style="font-size:12px; background:var(--primary); color:white; padding:4px 12px; border-radius:20px; text-decoration:none;">Ï†ÑÌôî</a>
                            </div>
                        </div>
                    </div>
                    <div style="display:flex; align-items:start; gap:12px; padding-top:12px;">
                        <div style="font-size:20px;">üéí</div>
                        <div style="flex:1;">
                            <div style="font-size:13px; color:var(--text-caption); margin-bottom:8px;">Ï§ÄÎπÑÎ¨º Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</div>
                            <div style="display:flex; flex-direction:column; gap:6px;">
                                ${detail.eventInfo.checklist.map(item => `
                                    <label style="display:flex; align-items:center; gap:8px; font-size:14px; color:var(--text-body); cursor:pointer;">
                                        <input type="checkbox" style="width:16px; height:16px; accent-color:var(--primary); border-radius:4px;">
                                        <span>${item}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        } else if (detail.specialInfo) {
            eventSection.style.display = 'block';
            eventSection.innerHTML = `
                <div style="background:rgba(255,255,255,0.9); border-radius:16px; padding:20px; box-shadow:var(--shadow-sm);">
                    <div style="display:flex; align-items:start; gap:12px;">
                        <div style="font-size:24px;">${detail.icon}</div>
                        <div style="flex:1;">
                            <div style="font-size:15px; color:var(--primary); margin-bottom:12px; font-weight:700;">${detail.specialInfo.title}</div>
                            <div style="display:flex; flex-direction:column; gap:8px;">
                                ${detail.specialInfo.items.map(item => `
                                    <div style="font-size:14px; color:var(--text-body); line-height:1.5;">
                                        ${item}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ÌåÅ ÏÑπÏÖò ÏóÖÎç∞Ïù¥Ìä∏
        detailPage.querySelector('.tips-section').innerHTML = `
            <div style="display:flex; align-items:start; gap:12px;">
                <div style="font-size:20px;">üí°</div>
                <div style="flex:1;">
                    <div style="font-size:13px; color:var(--primary); margin-bottom:8px; font-weight:600;">Ï∂îÏ≤ú ÌôúÎèô ÏãúÍ∞Ñ</div>
                    <div style="font-size:14px; color:var(--text-body); line-height:1.6;">
                        ${detail.tips}
                    </div>
                </div>
            </div>
        `;

        // ÌéòÏù¥ÏßÄ Ï†ÑÌôò
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        detailPage.classList.add('active');

        // Îí§Î°úÍ∞ÄÍ∏∞ Î≤ÑÌäº ÌëúÏãú
        document.getElementById('header-back-btn').style.visibility = 'visible';

        // ÌûàÏä§ÌÜ†Î¶¨Ïóê Ï∂îÍ∞Ä
        pageHistory.push('place-detail');

        // Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ Ï†ÄÏû•
        window.previousPage = 'place-detail';
    }

    // ÎÑ§ÎπÑ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
    function goToNaviPage() {
        if (!window.currentPlace) return;

        const detail = placeDetails[window.currentPlace];
        if (!detail || !detail.naviImage) return;

        // ÎÑ§ÎπÑ Ïù¥ÎØ∏ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
        const naviPage = document.getElementById('page-navi');
        const naviImage = naviPage.querySelector('#navi-image');
        if (naviImage) {
            naviImage.src = detail.naviImage;
            naviImage.alt = `${detail.name} ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò`;
        }

        // ÌéòÏù¥ÏßÄ Ï†ÑÌôò
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        naviPage.classList.add('active');
    }

    // ÎÑ§ÎπÑ ÌôîÎ©¥ÏóêÏÑú Îí§Î°úÍ∞ÄÍ∏∞
    function goBackFromNavi() {
        goToPage(window.previousPage || 'place-detail');
    }

    // Ïû•ÏÜå Îç∞Ïù¥ÌÑ∞ (ÏïÑÏù¥ÏΩò Ìè¨Ìï®)
    const placeOptionsData = [
        { name: 'Ìë∏Î•∏ÏÜî Í≥µÏõê ÎÜÄÏù¥ÌÑ∞', icon: 'üå≤', iconBg: '#E8F5E9', iconColor: '#4CAF50' },
        { name: 'ÍøàÎÇòÎ¨¥ Ïú†ÏπòÏõê', icon: 'üè´', iconBg: '#FFF3E0', iconColor: '#FF9800' },
        { name: 'ÎßùÌè¨ Í∏ÄÎπõ ÎèÑÏÑúÍ¥Ä', icon: 'üìö', iconBg: '#F3E5F5', iconColor: '#9C27B0' },
        { name: 'Í∏∞ÌÉÄ Ïû•ÏÜå', icon: 'üè¢', iconBg: '#E0E0E0', iconColor: '#757575' }
    ];

    // Ï±óÎ¥á Í∏∞Îä• - Î©îÏù∏ ÏßÑÏûÖÏ†ê (ÏÉàÎ°úÏö¥ ÏãúÎÇòÎ¶¨Ïò§)
    function initChat() {
        const chatBox = document.getElementById('chat-box');
        chatBox.innerHTML = ''; // Ï¥àÍ∏∞Ìôî

        // Ï¥àÍ∏∞ Î©îÎâ¥ ÌëúÏãú
        setTimeout(() => {
            addBotMsg("ÏïàÎÖïÌïòÏÑ∏Ïöî! <strong>LUMI</strong>ÏûÖÎãàÎã§. üßö‚Äç‚ôÄÔ∏è<br>Î¨¥ÏóáÏùÑ ÎèÑÏôÄÎìúÎ¶¥ÍπåÏöî?");

            setTimeout(() => {
                const options = ['ÏÑ±Í≥º Îì±Î°ù', 'ÌôúÎèô Ï∂îÏ≤ú', 'ÏßàÏùòÏùëÎãµ'];
                setChips(options, (val) => {
                    addUserMsg(val);
                    if (val === 'ÏÑ±Í≥º Îì±Î°ù') {
                        startSalesChatFlow();
                    } else if (val === 'ÌôúÎèô Ï∂îÏ≤ú') {
                        setTimeout(() => {
                            addBotMsg("ÎÑ§, Í∑∏Îüº Ï†úÍ∞Ä ÌòÑÏû¨ ÏúÑÏπòÏôÄ ÏãúÍ∞ÑÏùÑ Í≥†Î†§ÌïòÏó¨ Ï∂îÏ≤úÌï¥ÎìúÎ¶¥Í≤åÏöî!");
                            setTimeout(() => {
                                goToPage('recommend');
                            }, 1500);
                        }, 500);
                    } else if (val === 'ÏßàÏùòÏùëÎãµ') {
                        startQnAFlow();
                    }
                });
            }, 600);
        }, 400);
    }

    // --- ÏÑ±Í≥º Îì±Î°ù ÏãúÎÇòÎ¶¨Ïò§ (ÏÉàÎ°úÏö¥ ÏàúÏÑú: Î¶¨Îìú ‚Üí Ïû•ÏÜå ‚Üí ÏÑ±Í≥º ‚Üí ÌäπÏù¥ÏÇ¨Ìï≠) ---
    function startSalesChatFlow() {
        // ÏûÑÏãú Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
        window.tempSalesData = {
            placeName: '',
            icon: 'üìç',
            iconBg: '#E0E0E0',
            iconColor: '#757575',
            leads: 0,
            result: 'none',
            note: ''
        };

        // Q1. Î¶¨Îìú Ïàò ÏßàÎ¨∏
        setTimeout(() => {
            addBotMsg("Ïò§Îäò ÎßåÎÇú <strong>Î¶¨Îìú(Í∞ÄÎßùÍ≥†Í∞ù)</strong>Îäî Î™á Î∂ÑÏù¥Ïã†Í∞ÄÏöî?");
            const leadOptions = ['0Î™Ö', '1Î™Ö', '2Î™Ö', '3Î™Ö', '4Î™Ö', '5Î™Ö', '6Î™Ö Ïù¥ÏÉÅ'];
            setChips(leadOptions, (val) => {
                addUserMsg(val);
                if (val === '6Î™Ö Ïù¥ÏÉÅ') window.tempSalesData.leads = 6;
                else window.tempSalesData.leads = parseInt(val);

                // Q2. Ïû•ÏÜå ÏÑ†ÌÉù
                setTimeout(() => askPlace(), 600);
            });
        }, 600);
    }

    // Q2. Ïû•ÏÜå ÏÑ†ÌÉù
    function askPlace() {
        addBotMsg("Ïñ¥Îäê Ïû•ÏÜåÏóêÏÑú ÌôúÎèôÌïòÏÖ®ÎÇòÏöî?");

        const chipBox = getOrCreateChipBox();
        chipBox.innerHTML = '';

        // Í∏∞Ï°¥ Ïû•ÏÜå Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© (Í∏∞ÌÉÄ Ïû•ÏÜå Ïù¥ÎØ∏ Ìè¨Ìï®)
        const allPlaces = placeOptionsData;

        allPlaces.forEach(place => {
            const btn = document.createElement('div');
            btn.className = 'chip';
            btn.innerHTML = `${place.icon} ${place.name}`;
            btn.onclick = () => {
                if (place.name === 'Í∏∞ÌÉÄ Ïû•ÏÜå') {
                    addUserMsg(`${place.icon} ${place.name}`);
                    askManualPlaceInput();
                } else {
                    addUserMsg(`${place.icon} ${place.name}`);
                    window.tempSalesData.placeName = place.name;
                    window.tempSalesData.icon = place.icon;
                    window.tempSalesData.iconBg = place.iconBg;
                    window.tempSalesData.iconColor = place.iconColor;
                    chipBox.innerHTML = '';
                    // Î¶¨ÎìúÍ∞Ä 0Î™ÖÏù¥Î©¥ Í≥ÑÏïΩ ÏÑ±Í≥º ÏßàÎ¨∏ Í±¥ÎÑàÎõ∞Í∏∞
                    if (window.tempSalesData.leads === 0) {
                        window.tempSalesData.result = 'none';
                        setTimeout(() => askNote(), 600);
                    } else {
                        setTimeout(() => askResult(), 600);
                    }
                }
            };
            chipBox.appendChild(btn);
        });
    }

    // Í∏∞ÌÉÄ Ïû•ÏÜå ÏûÖÎ†• - ÌïòÎã® ÏûÖÎ†•Ï∞Ω ÏÇ¨Ïö©
    function askManualPlaceInput() {
        addBotMsg("Ïû•ÏÜå Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
        clearChips();

        chatInputMode = 'place'; // Ïû•ÏÜå ÏûÖÎ†• Î™®Îìú
        document.getElementById('chat-input').placeholder = 'Ïû•ÏÜå Ïù¥Î¶Ñ ÏûÖÎ†•...';
        document.getElementById('chat-input').focus();
    }

    // Q3. Í≥ÑÏïΩ ÏÑ±Í≥º ÏßàÎ¨∏
    function askResult() {
        addBotMsg("Í≥†ÏÉùÌïòÏÖ®ÏäµÎãàÎã§! ÌòπÏãú <strong>Í≥ÑÏïΩ ÏÑ±Í≥º</strong>ÎèÑ ÏûàÏóàÎÇòÏöî?");
        const resultOptions = ['ÏóÜÏùå', 'ÏÜåÏä§Îßå ÌôïÎ≥¥', 'Í≥ÑÏïΩ ÏÑ±Í≥µ!'];
        setChips(resultOptions, (val) => {
            addUserMsg(val);
            if(val === 'ÏóÜÏùå') window.tempSalesData.result = 'none';
            else if(val === 'ÏÜåÏä§Îßå ÌôïÎ≥¥') window.tempSalesData.result = 'source';
            else window.tempSalesData.result = 'success';

            setTimeout(() => askNote(), 600);
        });
    }

    // Q4. ÌäπÏù¥ÏÇ¨Ìï≠ ÏßàÎ¨∏ - ÌïòÎã® ÏûÖÎ†•Ï∞Ω ÏÇ¨Ïö©
    function askNote() {
        addBotMsg("Í∑∏Îüº Í∏∞ÌÉÄ ÌäπÏù¥ÏÇ¨Ìï≠ÏùÄ ÏûàÏóàÎÇòÏöî? üìù<br><span style='font-size:13px; color:var(--text-caption);'>(Ïòà: ÌåêÏ¥âÎ¨º ÌïÑÏöî Ïó¨Î∂Ä, Í¥ÄÎ†® Îã¥ÎãπÏûê ÏùëÎåÄ Î∞©Î≤ï)</span>");

        // ÏóÜÏùå Î≤ÑÌäºÎßå ÌëúÏãú
        setChips(['ÏóÜÏùå'], (val) => {
            completeNote('');
        });

        chatInputMode = 'note';
        document.getElementById('chat-input').placeholder = 'ÌäπÏù¥ÏÇ¨Ìï≠ ÏûÖÎ†•...';
        document.getElementById('chat-input').focus();
    }

    // ÌäπÏù¥ÏÇ¨Ìï≠ ÏôÑÎ£å Ï≤òÎ¶¨
    function completeNote(text) {
        window.tempSalesData.note = text;
        addUserMsg(text || 'ÏóÜÏùå');
        clearChips();

        chatInputMode = 'idle';
        document.getElementById('chat-input').placeholder = 'Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...';

        // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        const now = new Date();
        const newVisit = {
            id: visitHistoryData.length,
            name: window.tempSalesData.placeName,
            icon: window.tempSalesData.icon,
            iconBg: window.tempSalesData.iconBg,
            iconColor: window.tempSalesData.iconColor,
            date: now.toISOString().split('T')[0],
            startTime: `${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`,
            endTime: '',
            leads: window.tempSalesData.leads,
            result: window.tempSalesData.result,
            note: window.tempSalesData.note
        };
        visitHistoryData.unshift(newVisit);
        addNewHistoryCard(newVisit, 0); // ÎßàÏù¥ÌéòÏù¥ÏßÄÏóê ÏÉà Ïπ¥Îìú Ï∂îÍ∞Ä

        setTimeout(() => {
            addBotMsg("Í∏∞Î°ùÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§! ‚úÖ");
            setTimeout(() => {
                goToVisitResult(0); // Î∞©Í∏à Îì±Î°ùÌïú Ïπ¥Îìú ÏÑ∏Î∂Ä ÎÇ¥Ïö©ÏúºÎ°ú Ïù¥Îèô
            }, 1000);
        }, 600);
    }

    // --- ÌôúÎèô Ï∂îÏ≤ú ÏãúÎÇòÎ¶¨Ïò§ ---
    function startRecommendFlow() {
        setTimeout(() => {
            addBotMsg("Ïò§Îäò ÌôúÎèôÌï† Ïû•ÏÜåÎ•º Ï∂îÏ≤úÌï¥ÎìúÎ¶¥Í≤åÏöî! üó∫Ô∏è<br>Ïñ¥Îñ§ Ïú†ÌòïÏùò Ïû•ÏÜåÎ•º ÏõêÌïòÏãúÎÇòÏöî?");

            setTimeout(() => {
                const placeTypes = ['Í≥µÏõê/ÏïºÏô∏', 'Ïπ¥Ìéò/ÏãùÎãπ', 'ÏïÑÌååÌä∏/Ï£ºÍ±∞Îã®ÏßÄ', 'Í∏∞ÌÉÄ'];
                setChips(placeTypes, (selected) => {
                    addUserMsg(selected);

                    setTimeout(() => {
                        const recommendations = {
                            'Í≥µÏõê/ÏïºÏô∏': { name: 'Ìö®ÏõêÍ≥µÏõê', icon: 'üå≤', reason: 'Ï£ºÎßê Í∞ÄÏ°± Îã®ÏúÑ Î∞©Î¨∏Í∞ùÏù¥ ÎßéÏïÑÏöî' },
                            'Ïπ¥Ìéò/ÏãùÎãπ': { name: 'Î∏åÎü∞Ïπò Îπà', icon: '‚òï', reason: 'ÏßÅÏû•Ïù∏ Ï†êÏã¨ÏãúÍ∞ÑÏóê Ïú†ÎèôÏù∏Íµ¨Í∞Ä ÎßéÏïÑÏöî' },
                            'ÏïÑÌååÌä∏/Ï£ºÍ±∞Îã®ÏßÄ': { name: 'ÏïÑÏù¥ÌååÌÅ¨ Ï∫êÏä¨', icon: 'üè¢', reason: 'Ïã†Í∑ú ÏûÖÏ£º Í∞ÄÍµ¨Í∞Ä ÎßéÏùÄ Îã®ÏßÄÏòàÏöî' },
                            'Í∏∞ÌÉÄ': { name: 'ÌåêÌÉÄÏßÄÏõÄ', icon: 'üè∞', reason: 'Ï£ºÎßê Í∞ÄÏ°± Î∞©Î¨∏Í∞ùÏù¥ ÎßéÏùÄ ÌÇ§Ï¶àÏπ¥ÌéòÏòàÏöî' }
                        };

                        const rec = recommendations[selected] || recommendations['Í∏∞ÌÉÄ'];
                        addBotMsg(`<strong>${rec.icon} ${rec.name}</strong>ÏùÑ Ï∂îÏ≤úÎìúÎ†§Ïöî!<br><br>üìä <strong>Ï∂îÏ≤ú Ïù¥Ïú†:</strong> ${rec.reason}<br><br>Ïù¥ Ïû•ÏÜåÎ°ú ÌôúÎèôÏùÑ ÏãúÏûëÌïòÏãúÍ≤†Ïñ¥Ïöî?`);

                        setTimeout(() => {
                            setChips(['ÎÑ§, Ï∂úÎ∞úÌï†Í≤åÏöî!', 'Îã§Î•∏ Ïû•ÏÜå Ï∂îÏ≤ú'], (choice) => {
                                addUserMsg(choice);
                                if (choice === 'ÎÑ§, Ï∂úÎ∞úÌï†Í≤åÏöî!') {
                                    setTimeout(() => {
                                        addBotMsg("Ï¢ãÏïÑÏöî! ÌôîÏù¥ÌåÖÏûÖÎãàÎã§! üí™<br>ÌôúÎèô ÌõÑ ÏÑ±Í≥º Îì±Î°ùÏùÑ ÏûäÏßÄ ÎßàÏÑ∏Ïöî~");
                                    }, 500);
                                } else {
                                    startRecommendFlow();
                                }
                            });
                        }, 600);
                    }, 800);
                });
            }, 600);
        }, 500);
    }

    // --- ÏßàÏùòÏùëÎãµ ÏãúÎÇòÎ¶¨Ïò§ ---
    let qnaCount = 0;
    const MAX_QNA = 3;
    const GEMINI_API_KEY = 'AIzaSyCkNE0SokB0JeEfk_7Szz5uvaF5TTd8NfY';

    function startQnAFlow() {
        qnaCount = 0; // ÏßàÏùòÏùëÎãµ ÏãúÏûë Ïãú Ïπ¥Ïö¥Ìä∏ Ï¥àÍ∏∞Ìôî
        chatInputMode = 'qna'; // ÌïòÎã® ÏûÖÎ†•Ï∞ΩÏùÑ ÏßàÏùòÏùëÎãµ Î™®ÎìúÎ°ú ÏÑ§Ï†ï

        setTimeout(() => {
            addBotMsg(`Í∂ÅÍ∏àÌïú Ï†êÏùÑ ÏûêÏú†Î°≠Í≤å Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî! üí¨<br><span style='font-size:13px; color:var(--text-caption);'></span>`);
            // ÌïòÎã® ÏûÖÎ†•Ï∞Ω Ìè¨Ïª§Ïä§
            document.getElementById('chat-input').focus();
        }, 500);
    }

    // Ï¥àÍ∏∞ ÏòµÏÖò Îã§Ïãú ÌëúÏãú
    function showInitialOptions() {
        setTimeout(() => {
            const options = ['ÏÑ±Í≥º Îì±Î°ù', 'ÌôúÎèô Ï∂îÏ≤ú', 'ÏßàÏùòÏùëÎãµ'];
            setChips(options, (val) => {
                addUserMsg(val);
                if (val === 'ÏÑ±Í≥º Îì±Î°ù') {
                    startPerformanceFlow();
                } else if (val === 'ÌôúÎèô Ï∂îÏ≤ú') {
                    startActivityRecommendFlow();
                } else if (val === 'ÏßàÏùòÏùëÎãµ') {
                    startQnAFlow();
                }
            });
        }, 500);
    }

    // Gemini API Ìò∏Ï∂ú Ìï®Ïàò
    async function callGeminiAPI(question) {
        // ÎØ∏Î¶¨ Ï†ïÏùòÎêú ÎãµÎ≥Ä
        const predefinedAnswers = {
            'Ïú†ÏπòÏõê Î∂ÄÎ™® ÎåÄÏÉÅ ÏòÅÏóÖ Î∞©Î≤ï': 'Ïú†ÏπòÏõê Î∂ÄÎ™® ÎåÄÏÉÅ ÏòÅÏóÖÏùÄ Ïã†Î¢∞ Íµ¨Ï∂ïÏù¥ Ï§ëÏöîÌï©ÎãàÎã§. ÌïôÎ∂ÄÎ™® ÎåÄÏÉÅ ÏÑ§Î™ÖÌöåÎ•º ÌÜµÌï¥ ÍµêÏú° Ï≤†Ìïô, ÌîÑÎ°úÍ∑∏Îû®Ïùò Ïû•Ï†êÏùÑ ÏßÑÏÜîÌïòÍ≤å Ï†ÑÎã¨ÌïòÍ≥†, ÏûêÎÖÄÏùò ÏÑ±Ïû• Í∞ÄÎä•ÏÑ±ÏùÑ Ï†úÏãúÌïòÎäî Í≤ÉÏù¥ Ìö®Í≥ºÏ†ÅÏûÖÎãàÎã§. Í∏çÏ†ïÏ†ÅÏù∏ ÌõÑÍ∏∞ÎÇò Ï∂îÏ≤úÏùÑ ÌôúÏö©ÌïòÏó¨ Ïã†Î¢∞ÎèÑÎ•º ÎÜíÏù¥Îäî Í≤ÉÎèÑ Ï¢ãÏùÄ Î∞©Î≤ïÏûÖÎãàÎã§.'
        };

        // ÎØ∏Î¶¨ Ï†ïÏùòÎêú ÎãµÎ≥Ä ÌôïÏù∏
        const normalizedQuestion = question.trim();
        if (predefinedAnswers[normalizedQuestion]) {
            return predefinedAnswers[normalizedQuestion];
        }

        const systemPrompt = `ÎãπÏã†ÏùÄ ÏòÅÏóÖ ÌôúÎèôÏùÑ ÎèïÎäî AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ LUMIÏûÖÎãàÎã§.
ÏòÅÏóÖ Í¥ÄÎ†® ÏßàÎ¨∏Ïóê ÏπúÏ†àÌïòÍ≥† Í∞ÑÍ≤∞ÌïòÍ≤å ÎãµÎ≥ÄÌï¥Ï£ºÏÑ∏Ïöî.
ÎãµÎ≥ÄÏùÄ 2-3Î¨∏Ïû•ÏúºÎ°ú ÏßßÍ≤å Ìï¥Ï£ºÏÑ∏Ïöî.
ÏòÅÏóÖ, Í≥†Í∞ù, Î¶¨Îìú, Í≥ÑÏïΩ, ÌôúÎèô, Ïû•ÏÜå, Ï∂îÏ≤ú, Îß§Ï∂ú, ÏÉÅÎã¥, ÌåêÏ¥â Îì± ÏòÅÏóÖ Í¥ÄÎ†® ÏßàÎ¨∏Ïóê ÏßëÏ§ëÌï¥Ï£ºÏÑ∏Ïöî.`;

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `${systemPrompt}\n\nÏÇ¨Ïö©Ïûê ÏßàÎ¨∏: ${question}`
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 256,
                    }
                })
            });

            const data = await response.json();
            console.log('Gemini API Response:', data);

            if (data.error) {
                console.error('Gemini API Error:', data.error);
                return `API Ïò§Î•ò: ${data.error.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`;
            }

            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                return data.candidates[0].content.parts[0].text;
            } else {
                console.log('Unexpected response structure:', JSON.stringify(data));
                return "ÎãµÎ≥ÄÏùÑ ÏÉùÏÑ±ÌïòÎäî Îç∞ Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌñàÏñ¥Ïöî. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.";
            }
        } catch (error) {
            console.error('Gemini API Error:', error);
            return "ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏñ¥Ïöî. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.";
        }
    }

    // Ïπ© Î∞ïÏä§ Í∞ÄÏ†∏Ïò§Í∏∞ ÎòêÎäî ÏÉùÏÑ± Ìó¨Ìçº Ìï®Ïàò
    function getOrCreateChipBox() {
        let box = document.querySelector('#chat-box .quick-chips');
        if (!box) {
            box = document.createElement('div');
            box.className = 'quick-chips';
            box.id = 'quick-replies';
            document.getElementById('chat-box').appendChild(box);
        }
        return box;
    }

    // Ïπ© Î∞ïÏä§ ÎπÑÏö∞Í∏∞
    function clearChips() {
        const box = document.querySelector('#chat-box .quick-chips');
        if (box) box.innerHTML = '';
    }

    // setChips Ìó¨Ìçº Ìï®Ïàò - chat-box ÏïàÏóê Ïπ© Ï∂îÍ∞Ä
    function setChips(labels, callback) {
        const box = getOrCreateChipBox();
        box.innerHTML = '';

        labels.forEach(l => {
            const c = document.createElement('div');
            c.className = 'chip';
            c.innerText = l;
            c.onclick = () => callback(l);
            box.appendChild(c);
        });
    }

    // ÌïòÎã® ÏûÖÎ†•Î∞î Î©îÏãúÏßÄ Ï†ÑÏÜ°
    let chatInputMode = 'idle'; // 'qna' | 'place' | 'note' | 'idle'

    async function sendChatMessage() {
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        if (!message) return;

        input.value = '';

        // Ïû•ÏÜå ÏûÖÎ†• Î™®Îìú
        if (chatInputMode === 'place') {
            addUserMsg(message);
            window.tempSalesData.placeName = message;
            window.tempSalesData.icon = 'üè¢';
            window.tempSalesData.iconBg = '#E0E0E0';
            window.tempSalesData.iconColor = '#757575';
            chatInputMode = 'idle';
            input.placeholder = 'Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...';
            // Î¶¨ÎìúÍ∞Ä 0Î™ÖÏù¥Î©¥ Í≥ÑÏïΩ ÏÑ±Í≥º ÏßàÎ¨∏ Í±¥ÎÑàÎõ∞Í∏∞
            if (window.tempSalesData.leads === 0) {
                window.tempSalesData.result = 'none';
                setTimeout(() => askNote(), 600);
            } else {
                setTimeout(() => askResult(), 600);
            }
            return;
        }

        // ÌäπÏù¥ÏÇ¨Ìï≠ ÏûÖÎ†• Î™®Îìú
        if (chatInputMode === 'note') {
            completeNote(message);
            return;
        }

        // ÌäπÏù¥ÏÇ¨Ìï≠ ÏûÖÎ†• Î™®Îìú (ÌôúÎèô GO!ÏóêÏÑú)
        if (chatInputMode === 'note_sales') {
            completeNoteFromSales(message);
            return;
        }

        // ÏßàÏùòÏùëÎãµ Î™®ÎìúÏùº Îïå
        if (chatInputMode === 'qna') {
            if (qnaCount >= MAX_QNA) {
                addBotMsg("ÏßàÎ¨∏ ÌöüÏàòÎ•º Î™®Îëê ÏÇ¨Ïö©ÌñàÏñ¥Ïöî. Îã§Î•∏ Î©îÎâ¥Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!");
                chatInputMode = 'idle';
                input.placeholder = 'Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...';
                return;
            }

            qnaCount++;
            addUserMsg(message, true);

            // Gemini API Ìò∏Ï∂ú
            try {
                const response = await callGeminiAPI(message);
                addBotMsg(response);
            } catch (error) {
                addBotMsg("Ï£ÑÏÜ°Ìï¥Ïöî, ÎãµÎ≥ÄÏùÑ Í∞ÄÏ†∏Ïò§Îäî Îç∞ Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌñàÏñ¥Ïöî.");
            }

            // 3Ìöå Îã§ ÏÇ¨Ïö©ÌñàÏúºÎ©¥ Ï¢ÖÎ£å
            if (qnaCount >= MAX_QNA) {
                setTimeout(() => {
                    addBotMsg("ÏßàÎ¨∏ ÌöüÏàòÎ•º Î™®Îëê ÏÇ¨Ïö©ÌñàÏñ¥Ïöî. Îã§Î•∏ ÎèÑÏõÄÏù¥ ÌïÑÏöîÌïòÏãúÎ©¥ ÎßêÏîÄÌï¥Ï£ºÏÑ∏Ïöî!");
                    chatInputMode = 'idle';
                    input.placeholder = 'Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...';
                    showInitialOptions();
                }, 1000);
            }
        } else {
            // idle Î™®ÎìúÏóêÏÑú ÏûÖÎ†•ÌïòÎ©¥ ÏßàÏùòÏùëÎãµ ÏûêÎèô ÏãúÏûë
            addUserMsg(message);
            chatInputMode = 'qna';
            qnaCount = 1;

            try {
                const response = await callGeminiAPI(message);
                addBotMsg(response);
            } catch (error) {
                addBotMsg("Ï£ÑÏÜ°Ìï¥Ïöî, ÎãµÎ≥ÄÏùÑ Í∞ÄÏ†∏Ïò§Îäî Îç∞ Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌñàÏñ¥Ïöî.");
            }
        }
    }

    // Ï±ÑÌåÖ ÏûÖÎ†•Î∞î Ïù¥Î≤§Ìä∏ Ï¥àÍ∏∞Ìôî
    document.addEventListener('DOMContentLoaded', function() {
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('chat-send-btn');

        if (chatInput) {
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
        }

        if (sendBtn) {
            sendBtn.addEventListener('click', sendChatMessage);
        }
    });

    // ÌîåÎ°úÌåÖ Î≤ÑÌäºÏóêÏÑú Ï±óÎ¥á ÏßÑÏûÖ (LUMI)
    function openChatBot() {
        // goToPage('chat')Ïù¥ initChat()ÏùÑ Ìò∏Ï∂úÌïòÎØÄÎ°ú Í∑∏ÎÉ• ÌéòÏù¥ÏßÄ Ïù¥ÎèôÎßå ÌïòÎ©¥ Îê®
        goToPage('chat');
    }

    // --- [NEW] Ïò§Îäò ÌôúÎèô ÏôÑÎ£å Î¶¨Ìè¨Ìä∏ ---
    function showDailyReport() {
        const reportPage = document.getElementById('page-finish');
        const floatingBtn = document.querySelector('.floating-chat-btn');

        // 1. Î¶¨Ìè¨Ìä∏ ÌéòÏù¥ÏßÄ ÌëúÏãú
        reportPage.style.display = 'flex';

        // 2. ÌîåÎ°úÌåÖ Î≤ÑÌäº Ïà®ÍπÄ
        if (floatingBtn) floatingBtn.style.display = 'none';

        // 3. ÏàúÏ∞® Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
        const lumiContainer = reportPage.querySelector('.lumi-container');
        const line1 = reportPage.querySelector('.line-1');
        const line2 = reportPage.querySelector('.line-2');
        const line3 = reportPage.querySelector('.line-3');
        const line4 = reportPage.querySelector('.line-4');
        const line5 = reportPage.querySelector('.line-5');
        const closeBtn = reportPage.querySelector('.btn-close-report');

        // LUMI Îì±Ïû• (0.1s)
        setTimeout(() => {
            lumiContainer.style.opacity = '1';
            lumiContainer.style.transform = 'translateY(0)';
            lumiContainer.style.transition = 'all 0.6s ease-out';
        }, 100);

        // ÌÉÄÏù¥ÌãÄ (0.8s)
        setTimeout(() => {
            line1.style.display = 'block';
            line1.classList.add('fade-in-up');
        }, 800);

        // ÏÑ±Í≥º Î∞ïÏä§ (1.8s)
        setTimeout(() => {
            line2.style.display = 'block';
            line2.classList.add('fade-in-up');
        }, 1800);

        // Ïπ≠Ï∞¨ Î©òÌä∏ (3.0s)
        setTimeout(() => {
            line3.style.display = 'block';
            line3.classList.add('fade-in-up');
        }, 3000);

        // ÎÇ¥Ïùº Ï∂îÏ≤ú (4.2s)
        setTimeout(() => {
            line4.style.display = 'block';
            line4.classList.add('fade-in-up');
        }, 4200);

        // ÎßàÎ¨¥Î¶¨ Ïù∏ÏÇ¨ (5.2s)
        setTimeout(() => {
            line5.style.display = 'block';
            line5.classList.add('fade-in-up');
        }, 5200);

        // Îã´Í∏∞ Î≤ÑÌäº (6.0s)
        setTimeout(() => {
            closeBtn.style.display = 'inline-block';
            closeBtn.classList.add('fade-in-up');
        }, 6000);
    }

    function closeDailyReport() {
        const reportPage = document.getElementById('page-finish');
        const floatingBtn = document.querySelector('.floating-chat-btn');

        // 1. Î¶¨Ìè¨Ìä∏ ÌéòÏù¥ÏßÄ Ïà®ÍπÄ
        reportPage.style.display = 'none';

        // 2. ÌîåÎ°úÌåÖ Î≤ÑÌäº Îã§Ïãú ÌëúÏãú
        if (floatingBtn) floatingBtn.style.display = 'block';

        // 3. ÏöîÏÜåÎì§ Ï¥àÍ∏∞Ìôî (Îã§Ïùå Ïã§ÌñâÏùÑ ÏúÑÌï¥)
        const lumiContainer = reportPage.querySelector('.lumi-container');
        const lines = reportPage.querySelectorAll('.report-line, .report-box');
        const closeBtn = reportPage.querySelector('.btn-close-report');

        lumiContainer.style.opacity = '0';
        lumiContainer.style.transform = 'translateY(20px)';
        lumiContainer.style.transition = 'none';

        lines.forEach(el => {
            el.style.display = 'none';
            el.classList.remove('fade-in-up');
        });

        closeBtn.style.display = 'none';
        closeBtn.classList.remove('fade-in-up');
    }

    // ÌôúÎèô GO!ÏóêÏÑú ÏßÑÏûÖÌïòÎäî Ï±óÎ¥á
    function initSalesChat() {
        const chatBox = document.getElementById('chat-box');
        chatBox.innerHTML = ''; // Ï¥àÍ∏∞Ìôî

        const placeName = window.currentSalesPlace?.name || 'ÌòÑÏû¨ Ïû•ÏÜå';
        const placeIcon = window.currentSalesPlace?.icon || 'üìç';

        // ÏïÑÏù¥ÏΩò ÏÉâÏÉÅ Îß§Ìïë
        const iconColorMap = {
            'üå≤': { bg: '#E8F5E9', color: '#4CAF50' },
            'üè∞': { bg: '#FFF3E0', color: '#FF9800' },
            'üöå': { bg: '#E3F2FD', color: '#2196F3' },
            'üìö': { bg: '#F3E5F5', color: '#9C27B0' },
            '‚òï': { bg: '#FBE9E7', color: '#FF5722' },
            'üè´': { bg: '#FFF3E0', color: '#FF9800' },
            'üè¢': { bg: '#E0E0E0', color: '#757575' },
            'üìç': { bg: '#E0E0E0', color: '#757575' }
        };
        const iconStyle = iconColorMap[placeIcon] || { bg: '#E0E0E0', color: '#757575' };

        // ÏûÑÏãú Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
        window.tempSalesData = {
            placeName: placeName,
            icon: placeIcon,
            iconBg: iconStyle.bg,
            iconColor: iconStyle.color,
            leads: 0,
            result: 'none',
            note: ''
        };

        addBotMsg(`<strong>${placeName}</strong>ÏóêÏÑú ÏòÅÏóÖ ÌôúÎèôÏùÑ ÏãúÏûëÌïòÏÖ®Íµ∞Ïöî! üí™<br><br>Ïò§Îäò ÎßåÎÇú <strong>Î¶¨Îìú(Í∞ÄÎßùÍ≥†Í∞ù)</strong>Îäî Î™á Î∂ÑÏù¥Ïã†Í∞ÄÏöî?`);
        setTimeout(() => {
            startLeadQuestionChipsOnly();
        }, 600);
    }

    // Î¶¨Îìú ÏßàÎ¨∏ Ïπ©Îßå ÌëúÏãú (Î©îÏãúÏßÄ ÏóÜÏù¥ - ÌôúÎèô GO!ÏóêÏÑú ÏÇ¨Ïö©)
    function startLeadQuestionChipsOnly() {
        const chipBox = getOrCreateChipBox();
        chipBox.innerHTML = '';

        const leadOptions = ['0Î™Ö', '1Î™Ö', '2Î™Ö', '3Î™Ö', '4Î™Ö', '5Î™Ö', '6Î™Ö Ïù¥ÏÉÅ'];

        leadOptions.forEach(option => {
            const btn = document.createElement('div');
            btn.className = 'chip';
            btn.innerText = option;
            btn.onclick = () => {
                addUserMsg(option);

                if (option === '6Î™Ö Ïù¥ÏÉÅ') {
                    window.tempSalesData.leads = 6;
                } else {
                    window.tempSalesData.leads = parseInt(option);
                }

                chipBox.innerHTML = '';

                setTimeout(() => {
                    startResultQuestionFromSales();
                }, 600);
            };
            chipBox.appendChild(btn);
        });
    }

    // Î¶¨Îìú Ïàò ÏßàÎ¨∏Îßå ÌëúÏãú (ÌôúÎèô GO!ÏóêÏÑú ÏÇ¨Ïö©)
    function startResultQuestionFromSales() {
        addBotMsg("Í≥†ÏÉùÌïòÏÖ®ÏäµÎãàÎã§! ÌòπÏãú <strong>Í≥ÑÏïΩ ÏÑ±Í≥º</strong>ÎèÑ ÏûàÏóàÎÇòÏöî? üéâ");
        const resultOptions = ['ÏóÜÏùå', 'ÏÜåÏä§Îßå ÌôïÎ≥¥', 'Í≥ÑÏïΩ ÏÑ±Í≥µ!'];
        setChips(resultOptions, (val) => {
            addUserMsg(val);
            if(val === 'ÏóÜÏùå') window.tempSalesData.result = 'none';
            else if(val === 'ÏÜåÏä§Îßå ÌôïÎ≥¥') window.tempSalesData.result = 'source';
            else window.tempSalesData.result = 'success';

            setTimeout(() => askNoteFromSales(), 600);
        });
    }

    // ÌäπÏù¥ÏÇ¨Ìï≠ ÏßàÎ¨∏ (ÌôúÎèô GO!ÏóêÏÑú ÏÇ¨Ïö©) - ÌïòÎã® ÏûÖÎ†•Ï∞Ω ÏÇ¨Ïö©
    function askNoteFromSales() {
        addBotMsg("Í∑∏Îüº Í∏∞ÌÉÄ ÌäπÏù¥ÏÇ¨Ìï≠ÏùÄ ÏûàÏóàÎÇòÏöî? üìù<br><span style='font-size:13px; color:var(--text-caption);'>(Ïòà: ÌåêÏ¥âÎ¨º ÌïÑÏöî Ïó¨Î∂Ä, Í¥ÄÎ†® Îã¥ÎãπÏûê ÏùëÎåÄ Î∞©Î≤ï)</span>");

        // ÏóÜÏùå Î≤ÑÌäºÎßå ÌëúÏãú
        setChips(['ÏóÜÏùå'], (val) => {
            completeNoteFromSales('');
        });

        chatInputMode = 'note_sales';
        document.getElementById('chat-input').placeholder = 'ÌäπÏù¥ÏÇ¨Ìï≠ ÏûÖÎ†•...';
        document.getElementById('chat-input').focus();
    }

    // ÌäπÏù¥ÏÇ¨Ìï≠ ÏôÑÎ£å Ï≤òÎ¶¨ (ÌôúÎèô GO!ÏóêÏÑú)
    function completeNoteFromSales(text) {
        window.tempSalesData.note = text;
        addUserMsg(text || 'ÏóÜÏùå');
        clearChips();

        chatInputMode = 'idle';
        document.getElementById('chat-input').placeholder = 'Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...';

        // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        const now = new Date();
        const newVisit = {
            id: visitHistoryData.length,
            name: window.tempSalesData.placeName,
            icon: window.tempSalesData.icon,
            iconBg: window.tempSalesData.iconBg,
            iconColor: window.tempSalesData.iconColor,
            date: now.toISOString().split('T')[0],
            startTime: `${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`,
            endTime: '',
            leads: window.tempSalesData.leads,
            result: window.tempSalesData.result,
            note: window.tempSalesData.note
        };
        visitHistoryData.unshift(newVisit);
        addNewHistoryCard(newVisit, 0);

        setTimeout(() => {
            addBotMsg("Í∏∞Î°ùÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§. ÎßàÏù¥ÌéòÏù¥ÏßÄÏóêÏÑú ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî! ‚úÖ");
            setTimeout(() => {
                goToVisitResult(0);
            }, 1000);
        }, 600);
    }

    function addBotMsg(html) {
        const box = document.getElementById('chat-box');
        const bubble = document.createElement('div');
        bubble.className = 'chat-bubble bot';
        bubble.innerHTML = html;

        // Ïπ© Î∞ïÏä§Í∞Ä ÏûàÏúºÎ©¥ Í∑∏ ÏïûÏóê ÏÇΩÏûÖ, ÏóÜÏúºÎ©¥ Îß® Îí§Ïóê Ï∂îÍ∞Ä
        const chipBox = box.querySelector('.quick-chips');
        if (chipBox) {
            box.insertBefore(bubble, chipBox);
        } else {
            box.appendChild(bubble);
        }
        box.scrollTop = box.scrollHeight;
    }

    function addUserMsg(text, keepInput = false) {
        const box = document.getElementById('chat-box');
        const bubble = document.createElement('div');
        bubble.className = 'chat-bubble user';
        bubble.textContent = text;

        // Ïπ© Î∞ïÏä§Í∞Ä ÏûàÏúºÎ©¥ Í∑∏ ÏïûÏóê ÏÇΩÏûÖ, ÏóÜÏúºÎ©¥ Îß® Îí§Ïóê Ï∂îÍ∞Ä
        const chipBox = box.querySelector('.quick-chips');
        if (chipBox) {
            box.insertBefore(bubble, chipBox);
        } else {
            box.appendChild(bubble);
        }

        if (!keepInput) {
            clearChips(); // Ïπ© Ï†úÍ±∞
        }
        box.scrollTop = box.scrollHeight;
    }

    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
    window.addEventListener('DOMContentLoaded', function() {
        updateRandomHotspot();
        renderRandomPlaces(); // Ï∂îÏ≤ú Ïû•ÏÜå Ï¥àÍ∏∞ Î†åÎçîÎßÅ

        // Service Worker Îì±Î°ù
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service Worker Îì±Î°ù ÏôÑÎ£å'))
                .catch(err => console.log('Service Worker Îì±Î°ù Ïã§Ìå®:', err));
        }
    });

    // ========================================
    // PWA ÏÑ§Ïπò Í∏∞Îä•
    // ========================================
    let deferredPrompt = null;

    // beforeinstallprompt Ïù¥Î≤§Ìä∏ Í∞êÏßÄ (Android Chrome)
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        // ÏÑ§Ïπò Î≤ÑÌäº ÌëúÏãú
        document.getElementById('btn-install-pwa').classList.add('show');
    });

    // ÏÑ§Ïπò ÏôÑÎ£å ÌõÑ Î≤ÑÌäº Ïà®ÍπÄ
    window.addEventListener('appinstalled', () => {
        document.getElementById('btn-install-pwa').classList.remove('show');
        deferredPrompt = null;
    });

    // ÏÑ§Ïπò Î≤ÑÌäº ÌÅ¥Î¶≠ Ìï®Ïàò
    function installPWA() {
        const btn = document.getElementById('btn-install-pwa');
        const ua = navigator.userAgent;

        // Ïπ¥Ïπ¥Ïò§ÌÜ° Ïù∏Ïï± Î∏åÎùºÏö∞Ï†Ä Í∞êÏßÄ
        const isKakao = /KAKAOTALK/i.test(ua);
        if (isKakao) {
            alert('Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞ÄÌïòÎ†§Î©¥:\n\n1. Ïò§Î•∏Ï™Ω ÏÉÅÎã® ‚ãÆ Î©îÎâ¥Î•º ÌÉ≠ÌïòÏÑ∏Ïöî\n2. "Îã§Î•∏ Î∏åÎùºÏö∞Ï†ÄÎ°ú Ïó¥Í∏∞"Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî\n3. ChromeÏóêÏÑú Ïù¥ Î≤ÑÌäºÏùÑ Îã§Ïãú ÎàåÎü¨Ï£ºÏÑ∏Ïöî');
            return;
        }

        // Android Chrome - ÎÑ§Ïù¥Ìã∞Î∏å ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏
        if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('PWA ÏÑ§Ïπò ÏàòÎùΩ');
                }
                deferredPrompt = null;
            });
            return;
        }

        // iOS Safari - Ïù¥ÎØ∏ÏßÄ Î™®Îã¨Î°ú ÏïàÎÇ¥
        const isIOS = /iPad|iPhone|iPod/.test(ua);
        const isInStandaloneMode = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;

        if (isIOS && !isInStandaloneMode) {
            document.getElementById('modal-ios-install').classList.add('active');
            return;
        }

        // ÏÇºÏÑ± Ïù∏ÌÑ∞ÎÑ∑ Î∏åÎùºÏö∞Ï†Ä
        const isSamsungBrowser = /SamsungBrowser/i.test(ua);
        if (isSamsungBrowser) {
            alert('Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞ÄÌïòÎ†§Î©¥:\n\n1. ÌïòÎã® ‚â° Î©îÎâ¥Î•º ÌÉ≠ÌïòÏÑ∏Ïöî\n2. "ÌéòÏù¥ÏßÄ Ï∂îÍ∞Ä" ‚Üí "Ìôà ÌôîÎ©¥"ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî');
            return;
        }

        // Ïù¥ÎØ∏ ÏÑ§ÏπòÎêòÏóàÍ±∞ÎÇò ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Í≤ΩÏö∞
        if (isInStandaloneMode) {
            alert('Ïù¥ÎØ∏ Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞ÄÎêòÏñ¥ ÏûàÏäµÎãàÎã§!');
        } else {
            alert('Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞ÄÌïòÎ†§Î©¥:\n\nÎ∏åÎùºÏö∞Ï†Ä Î©îÎâ¥(‚ãÆ)ÏóêÏÑú "Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä"Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
        }
    }

    // Î™®Î∞îÏùºÏóêÏÑúÎäî Ìï≠ÏÉÅ Î≤ÑÌäº ÌëúÏãú (Í∞ÄÏù¥Îìú Ï†úÍ≥µÏö©)
    // standalone Î™®Îìú(Ïù¥ÎØ∏ ÏÑ§ÏπòÎê®)Í∞Ä ÏïÑÎãå Í≤ΩÏö∞ÏóêÎßå ÌëúÏãú
    document.addEventListener('DOMContentLoaded', () => {
        const isInStandaloneMode = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
        if (!isInStandaloneMode) {
            document.getElementById('btn-install-pwa').classList.add('show');
        }
    });

    // ========================================
    // Î∞©Î¨∏ Í≤∞Í≥º ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ Í¥ÄÎ†® Í∏∞Îä•
    // ========================================

    // ÏÉòÌîå Î∞©Î¨∏ Ïù¥Î†• Îç∞Ïù¥ÌÑ∞
    const visitHistoryData = [
        {
            id: 0,
            name: 'Ìë∏Î•∏ÏÜî Í≥µÏõê',
            icon: 'üå≤',
            iconBg: '#E8F5E9',
            iconColor: '#4CAF50',
            date: '2024-11-24',
            startTime: '14:00',
            endTime: '16:30',
            leads: 3,
            result: 'source', // none, source, success
            note: 'ÏïÑÏù¥ Îëê Î™Ö ÏóÑÎßà, ÍµêÏú°Ïóê Í¥ÄÏã¨ ÎßéÏùå.\nÎã§ÏùåÏ£º ÏÉÅÎã¥ ÏòàÏ†ï.'
        },
        {
            id: 1,
            name: 'ÍøàÎÇòÎ¨¥ Ïú†ÏπòÏõê',
            icon: 'üè´',
            iconBg: '#FFF3E0',
            iconColor: '#FF9800',
            date: '2024-11-23',
            startTime: '10:00',
            endTime: '12:00',
            leads: 2,
            result: 'none',
            note: 'ÌïòÏõê ÏãúÍ∞ÑÏóê ÎßûÏ∂∞ Î∞©Î¨∏.\nÌïôÎ∂ÄÎ™® Î∂ÑÏúÑÍ∏∞ Ï¢ãÏùå.'
        },
        {
            id: 2,
            name: 'ÎßùÌè¨ Í∏ÄÎπõ ÎèÑÏÑúÍ¥Ä',
            icon: 'üìö',
            iconBg: '#F3E5F5',
            iconColor: '#9C27B0',
            date: '2024-11-22',
            startTime: '15:00',
            endTime: '17:00',
            leads: 1,
            result: 'success',
            note: 'Ï¥àÎì±ÏÉù ÏóÑÎßà Í≥ÑÏïΩ ÏÑ±Í≥µ!\nÏòÅÏñ¥ ÌïôÏäµÏßÄ Ìå®ÌÇ§ÏßÄ.'
        }
    ];

    // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Î∞©Î¨∏ Ïù¥Î†• Ïù∏Îç±Ïä§
    let currentVisitIndex = 0;
    let selectedResultValue = 'none';

    // Î∞©Î¨∏ Í≤∞Í≥º ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
    function goToVisitResult(index) {
        currentVisitIndex = index;
        const visit = visitHistoryData[index];

        // Ìó§Îçî ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('visit-result-icon').textContent = visit.icon;
        document.getElementById('visit-result-title').textContent = visit.name;

        // ÎÇ†Ïßú/ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
        const dateObj = new Date(visit.date);
        const dateStr = `${dateObj.getFullYear()}ÎÖÑ ${dateObj.getMonth() + 1}Ïõî ${dateObj.getDate()}Ïùº`;
        document.getElementById('visit-date').textContent = dateStr;
        document.getElementById('visit-time').textContent = visit.endTime
            ? `${visit.startTime} ~ ${visit.endTime}`
            : `${visit.startTime} ~ (ÏßÑÌñâ Ï§ë)`;

        // Î¶¨Îìú ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('visit-leads').textContent = visit.leads + 'Î™Ö';

        // Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
        updateResultStatus(visit.result);

        // ÎπÑÍ≥† ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('visit-note').textContent = visit.note || 'Î©îÎ™® ÏóÜÏùå';

        // ÌéòÏù¥ÏßÄ Ï†ÑÌôò (goToPage ÏÇ¨Ïö©ÌïòÏó¨ ÌûàÏä§ÌÜ†Î¶¨ Í¥ÄÎ¶¨)
        goToPage('visit-result');
    }

    // Í≤∞Í≥º ÏÉÅÌÉú UI ÏóÖÎç∞Ïù¥Ìä∏
    function updateResultStatus(result) {
        const statusEl = document.getElementById('visit-result-status');
        statusEl.className = 'result-status ' + result;

        const statusText = {
            'none': 'ÏóÜÏùå',
            'source': 'ÏÜåÏä§Îßå ÌôïÎ≥¥',
            'success': 'Í≥ÑÏïΩ ÏÑ±Í≥µ'
        };
        statusEl.textContent = statusText[result] || 'ÏóÜÏùå';
    }

    // Î™®Îã¨ Ïó¥Í∏∞
    function openModal(type) {
        const visit = visitHistoryData[currentVisitIndex];

        if (type === 'datetime') {
            document.getElementById('input-date').value = visit.date;
            document.getElementById('input-start-time').value = visit.startTime;
            document.getElementById('input-end-time').value = visit.endTime;
        } else if (type === 'leads') {
            document.getElementById('input-leads').value = visit.leads;
        } else if (type === 'result') {
            selectedResultValue = visit.result;
            // ÏÑ†ÌÉù ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.result-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.value === visit.result) {
                    opt.classList.add('selected');
                }
            });
        } else if (type === 'note') {
            document.getElementById('input-note').value = visit.note || '';
        }

        document.getElementById('modal-' + type).classList.add('active');
    }

    // Î™®Îã¨ Îã´Í∏∞
    function closeModal(type) {
        document.getElementById('modal-' + type).classList.remove('active');
    }

    // Ïò§Î≤ÑÎ†àÏù¥ ÌÅ¥Î¶≠ Ïãú Î™®Îã¨ Îã´Í∏∞
    function closeModalOnOverlay(event, type) {
        if (event.target.classList.contains('modal-overlay')) {
            closeModal(type);
        }
    }

    // ÎÇ†Ïßú/ÏãúÍ∞Ñ Ï†ÄÏû•
    function saveDatetime() {
        const visit = visitHistoryData[currentVisitIndex];
        visit.date = document.getElementById('input-date').value;
        visit.startTime = document.getElementById('input-start-time').value;
        visit.endTime = document.getElementById('input-end-time').value;

        // UI ÏóÖÎç∞Ïù¥Ìä∏
        const dateObj = new Date(visit.date);
        const dateStr = `${dateObj.getFullYear()}ÎÖÑ ${dateObj.getMonth() + 1}Ïõî ${dateObj.getDate()}Ïùº`;
        document.getElementById('visit-date').textContent = dateStr;
        document.getElementById('visit-time').textContent = `${visit.startTime} ~ ${visit.endTime}`;

        closeModal('datetime');
    }

    // Î¶¨Îìú Ï†ÄÏû•
    function saveLeads() {
        const visit = visitHistoryData[currentVisitIndex];
        visit.leads = parseInt(document.getElementById('input-leads').value) || 0;

        // UI ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('visit-leads').textContent = visit.leads + 'Î™Ö';

        // ÎßàÏù¥ÌéòÏù¥ÏßÄ Ïù¥Î†• Ïπ¥ÎìúÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        updateHistoryCard(currentVisitIndex);

        closeModal('leads');
    }

    // Í≤∞Í≥º ÏòµÏÖò ÏÑ†ÌÉù
    function selectResultOption(element) {
        document.querySelectorAll('.result-option').forEach(opt => opt.classList.remove('selected'));
        element.classList.add('selected');
        selectedResultValue = element.dataset.value;
    }

    // Í≤∞Í≥º Ï†ÄÏû•
    function saveResult() {
        const visit = visitHistoryData[currentVisitIndex];
        visit.result = selectedResultValue;

        // UI ÏóÖÎç∞Ïù¥Ìä∏
        updateResultStatus(visit.result);

        closeModal('result');
    }

    // ÎπÑÍ≥† Ï†ÄÏû•
    function saveNote() {
        const visit = visitHistoryData[currentVisitIndex];
        visit.note = document.getElementById('input-note').value;

        // UI ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('visit-note').textContent = visit.note || 'Î©îÎ™® ÏóÜÏùå';

        closeModal('note');
    }

    // ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞
    let scheduleData = [
        { time: '09:00 - 10:00', text: 'ÏóÖÎ¨¥ ÌôïÏù∏ Î∞è Í∏∞Ï°¥ Í≥†Í∞ù Í¥ÄÎ¶¨', location: '' },
        { time: '10:00 - 11:00', text: 'ÎØ∏ÌåÖ Î∞è ÍµêÏú°', location: '' },
        { time: '11:00 - 12:00', text: 'ÏùºÏ†ïÏóÜÏùå', location: '', isFree: true },
        { time: '12:00 - 13:00', text: 'Ï†êÏã¨ ÏãúÍ∞Ñ', location: '' },
        { time: '13:00 - 14:00', text: 'ÎÇòÏõÖÏßÑ Í≥†Í∞ù ÏÉÅÎã¥', location: 'üìç ÏÇºÏÑ±1Ï∞®' },
        { time: '14:00 - 15:00', text: 'ÏùºÏ†ïÏóÜÏùå', location: '', isFree: true },
        { time: '15:00 - 17:00', text: 'ÌåêÏ¥â ÌôúÎèô', location: 'üìç ÍøàÎÇòÎ¨¥ Ïñ¥Î¶∞Ïù¥Ïßë' },
        { time: '17:00 - 18:00', text: 'ÏóÖÎ¨¥ ÎßàÎ¨¥Î¶¨', location: '' }
    ];
    let currentScheduleIndex = 0;

    // ÏùºÏ†ï ÏàòÏ†ï Î™®Îã¨ Ïó¥Í∏∞
    function openScheduleModal(index) {
        currentScheduleIndex = index;
        const schedule = scheduleData[index];

        document.getElementById('input-schedule-time').value = schedule.time;
        document.getElementById('input-schedule-text').value = schedule.text;
        document.getElementById('input-schedule-location').value = schedule.location;

        document.getElementById('modal-schedule').classList.add('active');
    }

    // ÏùºÏ†ï Ï†ÄÏû•
    function saveSchedule() {
        const schedule = scheduleData[currentScheduleIndex];
        schedule.text = document.getElementById('input-schedule-text').value;

        let location = document.getElementById('input-schedule-location').value.trim();
        // Ïû•ÏÜåÍ∞Ä ÏûàÍ≥† üìçÎ°ú ÏãúÏûëÌïòÏßÄ ÏïäÏúºÎ©¥ ÏûêÎèôÏúºÎ°ú Ï∂îÍ∞Ä
        if (location && !location.startsWith('üìç')) {
            location = 'üìç ' + location;
        }
        schedule.location = location;

        // UI ÏóÖÎç∞Ïù¥Ìä∏
        const rows = document.querySelectorAll('#schedule-list .schedule-row');
        const row = rows[currentScheduleIndex];
        if (row) {
            row.querySelector('.task-text').textContent = schedule.text;
            const subEl = row.querySelector('.task-sub');
            if (subEl) {
                subEl.textContent = schedule.location;
            }
        }

        closeModal('schedule');
    }

    // ÏùºÏ†ïÏóÜÏùåÏúºÎ°ú ÏÑ§Ï†ï
    function setScheduleFree() {
        const schedule = scheduleData[currentScheduleIndex];
        schedule.text = 'ÏùºÏ†ïÏóÜÏùå';
        schedule.location = '';
        schedule.isFree = true;

        // UI ÏóÖÎç∞Ïù¥Ìä∏
        const rows = document.querySelectorAll('#schedule-list .schedule-row');
        const row = rows[currentScheduleIndex];
        if (row) {
            // free ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä Î∞è ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î≥ÄÍ≤Ω
            row.classList.add('free');
            row.onclick = () => goToPage('recommend');

            // ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            const taskText = row.querySelector('.task-text');
            taskText.textContent = 'ÏùºÏ†ïÏóÜÏùå';
            taskText.classList.add('task-text-free');

            const taskSub = row.querySelector('.task-sub');
            if (taskSub) {
                taskSub.textContent = '‚ö°ÏòÅÏóÖÍ∞ÄÎä•';
                taskSub.classList.add('task-sub-free');
            }
        }

        closeModal('schedule');
    }

    // ÎßàÏù¥ÌéòÏù¥ÏßÄ Ïù¥Î†• Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
    function updateHistoryCard(index) {
        const visit = visitHistoryData[index];
        const historyCards = document.querySelectorAll('#history-list .history-card');

        if (historyCards[index]) {
            const timeEl = historyCards[index].querySelector('.place-time');
            const daysAgo = getDaysAgo(visit.date);
            timeEl.textContent = `${daysAgo} ¬∑ Î¶¨Îìú ${visit.leads}Î™Ö`;
        }
    }

    // Î©∞Ïπ† Ï†ÑÏù∏ÏßÄ Í≥ÑÏÇ∞
    function getDaysAgo(dateStr) {
        const visitDate = new Date(dateStr);
        const today = new Date();
        const diffTime = today - visitDate;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays === 0) return 'Ïò§Îäò Î∞©Î¨∏';
        if (diffDays === 1) return 'Ïñ¥Ï†ú Î∞©Î¨∏';
        return `${diffDays}Ïùº Ï†Ñ Î∞©Î¨∏`;
    }

    // ÌôúÎèô GO! - Ï±óÎ¥á ÏÑ±Í≥º ÏûÖÎ†• ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
    function startSalesActivity() {
        if (!window.currentPlace) {
            alert('Ïû•ÏÜåÎ•º Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
            return;
        }

        const detail = placeDetails[window.currentPlace];
        if (!detail) return;

        // ÌòÑÏû¨ Ïû•ÏÜå Ï†ïÎ≥¥ Ï†ÄÏû•
        window.currentSalesPlace = {
            name: detail.name,
            icon: detail.icon
        };

        // Ï±óÎ¥á Ìó§ÎçîÏóê Ïû•ÏÜåÎ™Ö ÌëúÏãú
        document.getElementById('chat-place-name').textContent = detail.name + ' ÏÑ±Í≥º ÏûÖÎ†•';

        // initChat Ïä§ÌÇµ ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï
        window.skipInitChat = true;

        // Ï±óÎ¥á ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÍ≥† ÎåÄÌôî ÏãúÏûë
        goToPage('chat');
        initSalesChat();
    }

    // ÎßàÏù¥ÌéòÏù¥ÏßÄÏóê ÏÉà Ïù¥Î†• Ïπ¥Îìú Ï∂îÍ∞Ä
    function addNewHistoryCard(visit, index) {
        const historyList = document.getElementById('history-list');
        const newCard = document.createElement('div');
        newCard.className = 'place-card history-card';
        newCard.onclick = () => goToVisitResult(index);
        newCard.innerHTML = `
            <div class="place-img" style="background:${visit.iconBg}; color:${visit.iconColor};">${visit.icon}</div>
            <div class="place-info">
                <div class="place-name">${visit.name}</div>
                <div class="place-time" style="color:#999;">Ïò§Îäò Î∞©Î¨∏ ¬∑ Î¶¨Îìú ${visit.leads}Î™Ö</div>
            </div>
            <div class="arrow-icon">‚Ä∫</div>
        `;

        // Îß® ÏúÑÏóê Ï∂îÍ∞Ä
        historyList.insertBefore(newCard, historyList.firstChild);

        // Í∏∞Ï°¥ Ïπ¥ÎìúÎì§Ïùò onclick Ïù∏Îç±Ïä§ ÏóÖÎç∞Ïù¥Ìä∏
        updateHistoryCardIndices();
    }

    // Ïù¥Î†• Ïπ¥Îìú Ïù∏Îç±Ïä§ ÏóÖÎç∞Ïù¥Ìä∏
    function updateHistoryCardIndices() {
        const cards = document.querySelectorAll('#history-list .history-card');
        cards.forEach((card, idx) => {
            card.onclick = () => goToVisitResult(idx);
        });
    }

    // ÏÉàÎ°ú ÏÉùÏÑ±Îêú Î∞©Î¨∏ Í∏∞Î°ù ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô (Îí§Î°úÍ∞ÄÍ∏∞ Ïãú ÎßàÏù¥ÌéòÏù¥ÏßÄÎ°ú)
    function goToVisitResultNew(index) {
        currentVisitIndex = index;
        const visit = visitHistoryData[index];

        // Ìó§Îçî ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('visit-result-icon').textContent = visit.icon;
        document.getElementById('visit-result-title').textContent = visit.name;

        // ÎÇ†Ïßú/ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
        const dateObj = new Date(visit.date);
        const dateStr = `${dateObj.getFullYear()}ÎÖÑ ${dateObj.getMonth() + 1}Ïõî ${dateObj.getDate()}Ïùº`;
        document.getElementById('visit-date').textContent = dateStr;
        document.getElementById('visit-time').textContent = visit.endTime
            ? `${visit.startTime} ~ ${visit.endTime}`
            : `${visit.startTime} ~ (ÏßÑÌñâ Ï§ë)`;

        // Î¶¨Îìú ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('visit-leads').textContent = visit.leads + 'Î™Ö';

        // Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
        updateResultStatus(visit.result);

        // ÎπÑÍ≥† ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('visit-note').textContent = visit.note || 'Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî';

        // ÌéòÏù¥ÏßÄ Ï†ÑÌôò
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-visit-result').classList.add('active');
    }

</script>

</body>
</html>
